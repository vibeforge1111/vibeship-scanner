# Cross-Language Secret Detection Rules
# These patterns apply to ALL languages in every scan
rules:
  # ============================================
  # API Keys & Tokens
  # ============================================

  - id: shared-openai-api-key
    pattern-regex: 'sk-[a-zA-Z0-9]{20,}'
    message: OpenAI API key detected - rotate immediately and use environment variables
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-anthropic-api-key
    pattern-regex: 'sk-ant-[a-zA-Z0-9\-]{20,}'
    message: Anthropic API key detected - rotate immediately and use environment variables
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-stripe-api-key
    pattern-regex: 'sk_live_[a-zA-Z0-9]{20,}'
    message: Stripe live API key detected - this is a production secret
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-stripe-test-key
    pattern-regex: 'sk_test_[a-zA-Z0-9]{20,}'
    message: Stripe test API key detected - still should use environment variables
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: WARNING

  - id: shared-aws-access-key
    pattern-regex: 'AKIA[0-9A-Z]{16}'
    message: AWS Access Key ID detected - use IAM roles or environment variables
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-aws-secret-key
    pattern-regex: '[a-zA-Z0-9/+]{40}'
    message: Potential AWS Secret Access Key - verify and rotate if exposed
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: WARNING

  - id: shared-github-token
    pattern-regex: 'ghp_[a-zA-Z0-9]{36}'
    message: GitHub Personal Access Token detected - rotate immediately
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-github-oauth
    pattern-regex: 'gho_[a-zA-Z0-9]{36}'
    message: GitHub OAuth Access Token detected - rotate immediately
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-github-app
    pattern-regex: 'ghu_[a-zA-Z0-9]{36}'
    message: GitHub App User-to-Server Token detected
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-slack-token
    pattern-regex: 'xox[baprs]-[a-zA-Z0-9\-]{10,}'
    message: Slack token detected - rotate and use environment variables
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-slack-webhook
    pattern-regex: 'https://hooks\.slack\.com/services/T[A-Z0-9]+/B[A-Z0-9]+/[a-zA-Z0-9]+'
    message: Slack webhook URL detected - treat as secret
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-discord-webhook
    pattern-regex: 'https://discord(app)?\.com/api/webhooks/[0-9]+/[a-zA-Z0-9_\-]+'
    message: Discord webhook URL detected - treat as secret
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-twilio-api-key
    pattern-regex: 'SK[a-f0-9]{32}'
    message: Twilio API Key detected
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-sendgrid-api-key
    pattern-regex: 'SG\.[a-zA-Z0-9_\-]{22}\.[a-zA-Z0-9_\-]{43}'
    message: SendGrid API Key detected
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-mailgun-api-key
    pattern-regex: 'key-[a-f0-9]{32}'
    message: Mailgun API Key detected
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-firebase-api-key
    pattern-regex: 'AIza[a-zA-Z0-9_\-]{35}'
    message: Firebase/Google API Key detected
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: WARNING

  - id: shared-google-oauth-client
    pattern-regex: '[0-9]+-[a-z0-9]+\.apps\.googleusercontent\.com'
    message: Google OAuth Client ID detected - verify if should be public
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: INFO

  # ============================================
  # Database Connection Strings
  # ============================================

  - id: shared-postgres-connection
    pattern-regex: "postgres(ql)?://[^:]+:[^@]+@[^/]+/[^\\s\"']+"
    message: PostgreSQL connection string with credentials detected
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-mysql-connection
    pattern-regex: "mysql://[^:]+:[^@]+@[^/]+/[^\\s\"']+"
    message: MySQL connection string with credentials detected
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-mongodb-connection
    pattern-regex: "mongodb(\\+srv)?://[^:]+:[^@]+@[^\\s\"']+"
    message: MongoDB connection string with credentials detected
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-redis-connection
    pattern-regex: "redis://[^:]*:[^@]+@[^\\s\"']+"
    message: Redis connection string with credentials detected
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  # ============================================
  # Private Keys
  # ============================================

  - id: shared-rsa-private-key
    pattern-regex: '-----BEGIN RSA PRIVATE KEY-----'
    message: RSA private key detected - never commit private keys
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-openssh-private-key
    pattern-regex: '-----BEGIN OPENSSH PRIVATE KEY-----'
    message: OpenSSH private key detected - never commit private keys
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-ec-private-key
    pattern-regex: '-----BEGIN EC PRIVATE KEY-----'
    message: EC private key detected - never commit private keys
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-pgp-private-key
    pattern-regex: '-----BEGIN PGP PRIVATE KEY BLOCK-----'
    message: PGP private key detected - never commit private keys
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  # ============================================
  # Generic Patterns
  # ============================================

  - id: shared-generic-api-key-assignment
    pattern-either:
      - pattern: 'api_key = "..."'
      - pattern: 'apiKey = "..."'
      - pattern: 'API_KEY = "..."'
      - pattern: 'const apiKey = "..."'
      - pattern: 'let apiKey = "..."'
    message: Hardcoded API key assignment detected
    languages: [python, javascript, typescript]
    severity: ERROR

  - id: shared-generic-secret-assignment
    pattern-either:
      - pattern: 'secret = "..."'
      - pattern: 'SECRET = "..."'
      - pattern: 'secret_key = "..."'
      - pattern: 'SECRET_KEY = "..."'
      - pattern: 'const secret = "..."'
    message: Hardcoded secret assignment detected
    languages: [python, javascript, typescript]
    severity: ERROR

  - id: shared-generic-password-assignment
    pattern-either:
      - pattern: 'password = "..."'
      - pattern: 'PASSWORD = "..."'
      - pattern: 'const password = "..."'
      - pattern: 'let password = "..."'
    message: Hardcoded password detected
    languages: [python, javascript, typescript]
    severity: ERROR

  - id: shared-bearer-token
    pattern-regex: 'Bearer [a-zA-Z0-9_\-\.]{20,}'
    message: Bearer token detected in code - use environment variables
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-basic-auth
    pattern-regex: 'Basic [a-zA-Z0-9+/=]{20,}'
    message: Basic auth credentials detected in code
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  # ============================================
  # Cloud Provider Secrets
  # ============================================

  - id: shared-azure-connection-string
    pattern-regex: 'DefaultEndpointsProtocol=https;AccountName=[^;]+;AccountKey=[a-zA-Z0-9+/=]{88}'
    message: Azure Storage connection string detected
    languages: [python, javascript, typescript, go, java, csharp]
    severity: ERROR

  - id: shared-gcp-service-account
    pattern-regex: '"type":\s*"service_account"'
    message: GCP Service Account JSON detected - should not be in code
    languages: [python, javascript, typescript, go, java]
    severity: ERROR

  - id: shared-heroku-api-key
    pattern-regex: '[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}'
    message: Potential Heroku API key (UUID format) - verify if secret
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: INFO

  # ============================================
  # Cryptocurrency / Web3
  # ============================================

  - id: shared-ethereum-private-key
    pattern-regex: '0x[a-fA-F0-9]{64}'
    message: Potential Ethereum private key detected - CRITICAL if real
    languages: [python, javascript, typescript, solidity]
    severity: ERROR

  - id: shared-mnemonic-phrase
    pattern-regex: '(abandon|ability|able|about|above|absent|absorb|abstract|absurd|abuse)(\s+\w+){11,23}'
    message: Potential mnemonic seed phrase detected - CRITICAL if real
    languages: [python, javascript, typescript, solidity]
    severity: ERROR

  # ============================================
  # Payment Card Data (PCI DSS)
  # ============================================

  - id: shared-credit-card-visa
    pattern-regex: '4[0-9]{15}'
    message: Potential Visa card number detected - PCI DSS violation if real
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-credit-card-mastercard
    pattern-regex: '5[1-5][0-9]{14}'
    message: Potential Mastercard number detected - PCI DSS violation if real
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-credit-card-amex
    pattern-regex: '3[47][0-9]{13}'
    message: Potential American Express card number detected - PCI DSS violation if real
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-credit-card-discover
    pattern-regex: '6(?:011|5[0-9]{2})[0-9]{12}'
    message: Potential Discover card number detected - PCI DSS violation if real
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  - id: shared-cvv-hardcoded
    pattern-regex: "cvv['\"]?\\s*[:=]\\s*['\"]?[0-9]{3,4}['\"]?"
    message: Hardcoded CVV/CVC detected - never store card security codes
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR

  # ============================================
  # Common Weak/Default Passwords
  # ============================================

  # Common weak passwords AI tends to generate
  - id: shared-weak-password-common
    pattern-regex: "(?:password|passwd|pwd|secret|pass)\\s*[:=]\\s*['\"](?:password|password123|admin|admin123|123456|12345678|qwerty|letmein|welcome|monkey|dragon|master|abc123|111111|passw0rd|Password1|changeme|test|guest)['\"]"
    message: "Hardcoded weak password detected - use strong, unique passwords (CWE-798)"
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR
    metadata:
      cwe: "CWE-798"
      owasp: "A07:2021 Identification and Authentication Failures"

  # Default credentials pattern
  - id: shared-default-credentials
    pattern-regex: "(?:username|user)\\s*[:=]\\s*['\"]admin['\"].*(?:password|pass)\\s*[:=]\\s*['\"]admin['\"]"
    message: "Default admin:admin credentials - change immediately (CWE-798)"
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR
    metadata:
      cwe: "CWE-798"

  # Secret set to "secret" or similar
  - id: shared-secret-placeholder
    pattern-regex: "(?:secret|jwt_secret|api_secret|secret_key)\\s*[:=]\\s*['\"](?:secret|mysecret|your-secret|your_secret|change-me|changeme|supersecret)['\"]"
    message: "Placeholder secret value - use strong random secret (CWE-798)"
    languages: [python, javascript, typescript, go, java, ruby, php]
    severity: ERROR
    metadata:
      cwe: "CWE-798"
