# Swift Security Rules
rules:
  # ============================================
  # Command Injection
  # ============================================

  - id: swift-process-launch
    pattern: Process().launchPath = $PATH
    message: Swift process execution - command injection risk
    languages: [swift]
    severity: WARNING

  - id: swift-process-arguments
    pattern: $PROC.arguments = $ARGS
    message: Swift process arguments - injection risk if user-controlled
    languages: [swift]
    severity: WARNING

  - id: swift-shell-command
    pattern: shell($CMD)
    message: Swift shell command execution - injection risk
    languages: [swift]
    severity: ERROR

  # ============================================
  # Insecure Data Storage
  # ============================================

  - id: swift-userdefaults-sensitive
    pattern: 'UserDefaults.standard.set($VALUE, forKey: $KEY)'
    message: Swift UserDefaults - not secure for sensitive data, use Keychain
    languages: [swift]
    severity: WARNING

  - id: swift-nsuserdefaults-sensitive
    pattern: 'NSUserDefaults.standardUserDefaults().setObject($VALUE, forKey: $KEY)'
    message: Swift NSUserDefaults - not secure for sensitive data
    languages: [swift]
    severity: WARNING

  # ============================================
  # Weak Cryptography
  # ============================================

  - id: swift-md5
    pattern: CC_MD5(...)
    message: Swift MD5 is weak - use SHA-256 or better
    languages: [swift]
    severity: WARNING

  - id: swift-sha1
    pattern: CC_SHA1(...)
    message: Swift SHA1 is deprecated - use SHA-256 or better
    languages: [swift]
    severity: WARNING

  - id: swift-insecure-random
    pattern: arc4random()
    message: Swift arc4random - use SecRandomCopyBytes for crypto
    languages: [swift]
    severity: INFO

  - id: swift-des
    pattern: kCCAlgorithmDES
    message: Swift DES is weak - use AES
    languages: [swift]
    severity: ERROR

  - id: swift-3des
    pattern: kCCAlgorithm3DES
    message: Swift 3DES is deprecated - use AES
    languages: [swift]
    severity: WARNING

  - id: swift-ecb-mode
    pattern: kCCOptionECBMode
    message: Swift ECB mode is insecure - use CBC or GCM
    languages: [swift]
    severity: ERROR

  # ============================================
  # SSL/TLS Issues
  # ============================================

  - id: swift-allow-invalid-certs
    pattern: allowsInvalidSSLCertificate = true
    message: Swift SSL certificate validation disabled
    languages: [swift]
    severity: ERROR

  - id: swift-ssl-pinning-disabled
    pattern: 'ServerTrustPolicy.disableEvaluation'
    message: Swift SSL pinning disabled
    languages: [swift]
    severity: ERROR

  - id: swift-ats-disabled
    pattern: 'NSAppTransportSecurity'
    message: Swift ATS configuration - ensure exceptions are justified
    languages: [swift]
    severity: INFO

  - id: swift-ats-allow-arbitrary
    pattern: 'NSAllowsArbitraryLoads'
    message: Swift ATS allows arbitrary loads - security risk
    languages: [swift]
    severity: WARNING

  # ============================================
  # Path Traversal
  # ============================================

  - id: swift-filemanager-contents
    pattern: 'FileManager.default.contents(atPath: $PATH)'
    message: Swift file read - validate path for traversal
    languages: [swift]
    severity: WARNING

  - id: swift-string-write
    pattern: '$STRING.write(toFile: $PATH, ...)'
    message: Swift file write - validate path for traversal
    languages: [swift]
    severity: WARNING

  - id: swift-data-write
    pattern: '$DATA.write(to: $URL, ...)'
    message: Swift data write - validate destination
    languages: [swift]
    severity: WARNING

  # ============================================
  # URL/SSRF
  # ============================================

  - id: swift-url-user-input
    pattern: 'URL(string: $USER_INPUT)'
    message: Swift URL from user input - potential SSRF
    languages: [swift]
    severity: WARNING

  - id: swift-urlsession-request
    pattern: 'URLSession.shared.dataTask(with: $URL, ...)'
    message: Swift URL request - validate URL for SSRF
    languages: [swift]
    severity: INFO

  # ============================================
  # iOS Specific
  # ============================================

  - id: swift-webview-js-enabled
    pattern: '$WEBVIEW.configuration.preferences.javaScriptEnabled = true'
    message: Swift WKWebView JavaScript enabled - XSS risk
    languages: [swift]
    severity: WARNING

  - id: swift-uiwebview
    pattern: UIWebView
    message: Swift UIWebView is deprecated and insecure - use WKWebView
    languages: [swift]
    severity: ERROR

  - id: swift-pasteboard-sensitive
    pattern: 'UIPasteboard.general.string = $VALUE'
    message: Swift pasteboard - sensitive data may be accessible to other apps
    languages: [swift]
    severity: WARNING

  - id: swift-open-url
    pattern: 'UIApplication.shared.open($URL, ...)'
    message: Swift openURL - validate URL to prevent scheme hijacking
    languages: [swift]
    severity: WARNING

  - id: swift-canopen-url
    pattern: UIApplication.shared.canOpenURL($URL)
    message: Swift canOpenURL - validate URL schemes
    languages: [swift]
    severity: INFO

  # ============================================
  # Biometric Authentication
  # ============================================

  - id: swift-localauth-fallback
    pattern: 'LAPolicy.deviceOwnerAuthentication'
    message: Swift LocalAuthentication allows passcode fallback - consider biometrics only
    languages: [swift]
    severity: INFO

  # ============================================
  # Hardcoded Credentials
  # ============================================

  - id: swift-hardcoded-password
    pattern: 'let password = "..."'
    message: Swift hardcoded password detected
    languages: [swift]
    severity: ERROR

  - id: swift-hardcoded-secret
    pattern: 'let secret = "..."'
    message: Swift hardcoded secret detected
    languages: [swift]
    severity: ERROR

  - id: swift-hardcoded-apikey
    pattern: 'let apiKey = "..."'
    message: Swift hardcoded API key detected
    languages: [swift]
    severity: ERROR

  - id: swift-hardcoded-token
    pattern: 'let token = "..."'
    message: Swift hardcoded token detected
    languages: [swift]
    severity: ERROR

  # ============================================
  # Logging Sensitive Data
  # ============================================

  - id: swift-nslog-sensitive
    pattern: NSLog($FORMAT, ...)
    message: Swift NSLog - avoid logging sensitive data
    languages: [swift]
    severity: INFO

  - id: swift-print-debug
    pattern: print(...)
    message: Swift print - use os_log, avoid in production
    languages: [swift]
    severity: INFO

  # ============================================
  # Jailbreak Detection
  # ============================================

  - id: swift-jailbreak-check
    pattern: 'FileManager.default.fileExists(atPath: "/Applications/Cydia.app")'
    message: Swift jailbreak detection - attackers can bypass
    languages: [swift]
    severity: INFO

  # ============================================
  # SQL Injection (SQLite)
  # ============================================

  - id: swift-sqlite-query-concat
    pattern: sqlite3_exec($DB, $QUERY + $VAR, ...)
    message: Swift SQLite query concatenation - SQL injection risk
    languages: [swift]
    severity: ERROR

  - id: swift-sqlite-prepare-concat
    pattern: sqlite3_prepare_v2($DB, $QUERY + $VAR, ...)
    message: Swift SQLite prepare concatenation - SQL injection risk
    languages: [swift]
    severity: ERROR

  # ============================================
  # Insecure Deserialization
  # ============================================

  - id: swift-nskeyedunarchiver-unsafe
    pattern: 'NSKeyedUnarchiver.unarchiveObject(with: $DATA)'
    message: "Swift NSKeyedUnarchiver.unarchiveObject is insecure - use unarchivedObject with requiredSecureCoding (CWE-502)"
    languages: [swift]
    severity: ERROR
    metadata:
      cwe: "CWE-502"
      tags: [deserialization]

  - id: swift-nskeyedunarchiver-unarchive-file
    pattern: 'NSKeyedUnarchiver.unarchiveObject(withFile: $PATH)'
    message: "Swift NSKeyedUnarchiver.unarchiveObject(withFile:) is insecure - use unarchivedObject with requiredSecureCoding (CWE-502)"
    languages: [swift]
    severity: ERROR
    metadata:
      cwe: "CWE-502"
      tags: [deserialization]

  - id: swift-nskeyedunarchiver-no-secure-coding
    pattern: '$UNARCHIVER.requiresSecureCoding = false'
    message: "Swift NSKeyedUnarchiver without secure coding - insecure deserialization (CWE-502)"
    languages: [swift]
    severity: ERROR
    metadata:
      cwe: "CWE-502"
      tags: [deserialization]

  - id: swift-nscoding-init
    pattern: 'init?(coder: NSCoder)'
    message: "Swift NSCoding implementation - ensure class uses NSSecureCoding for untrusted data (CWE-502)"
    languages: [swift]
    severity: INFO
    metadata:
      cwe: "CWE-502"
      tags: [deserialization]

  - id: swift-nscoder-decode-object
    pattern: '$CODER.decodeObject(forKey: $KEY)'
    message: "Swift NSCoder.decodeObject without type check - use decodeObject(of:forKey:) instead (CWE-502)"
    languages: [swift]
    severity: WARNING
    metadata:
      cwe: "CWE-502"
      tags: [deserialization]

  - id: swift-propertylistdecoder
    pattern: 'PropertyListDecoder().decode($TYPE, from: $DATA)'
    message: "Swift PropertyListDecoder - validate source of data before decoding (CWE-502)"
    languages: [swift]
    severity: INFO
    metadata:
      cwe: "CWE-502"
      tags: [deserialization]

  - id: swift-jsondecoder-any
    pattern: 'JSONDecoder().decode(Any.self, from: $DATA)'
    message: "Swift JSONDecoder with Any type - prefer explicit types (CWE-502)"
    languages: [swift]
    severity: WARNING
    metadata:
      cwe: "CWE-502"
      tags: [deserialization]

  - id: swift-nskeyedarchiver-archived
    pattern: 'NSKeyedArchiver.archivedData(withRootObject: $OBJ)'
    message: "Swift deprecated archiving method - use archivedData(withRootObject:requiringSecureCoding:) (CWE-502)"
    languages: [swift]
    severity: WARNING
    metadata:
      cwe: "CWE-502"
      tags: [deserialization]

  # ============================================
  # Insecure Storage - Extended (iGoat-Swift Gap)
  # ============================================

  - id: swift-plist-sensitive
    pattern: 'NSDictionary(contentsOfFile: $PATH)'
    message: "Swift Plist file - not secure for sensitive data, use Keychain (CWE-312)"
    languages: [swift]
    severity: WARNING
    metadata:
      cwe: "CWE-312"
      tags: [insecure-storage]

  - id: swift-plist-write
    pattern: '$DICT.write(toFile: $PATH, atomically: ...)'
    message: "Swift Plist write - do not store sensitive data in plist files (CWE-312)"
    languages: [swift]
    severity: WARNING
    metadata:
      cwe: "CWE-312"
      tags: [insecure-storage]

  - id: swift-coredata-unencrypted
    pattern: 'NSPersistentStoreCoordinator(...)'
    message: "Swift CoreData - consider encryption for sensitive data (CWE-312)"
    languages: [swift]
    severity: INFO
    metadata:
      cwe: "CWE-312"
      tags: [insecure-storage]

  - id: swift-realm-unencrypted
    pattern: 'Realm()'
    message: "Swift Realm database - use encryptionKey for sensitive data (CWE-312)"
    languages: [swift]
    severity: WARNING
    metadata:
      cwe: "CWE-312"
      tags: [insecure-storage]

  - id: swift-realm-config-no-encryption
    pattern: 'Realm.Configuration()'
    message: "Swift Realm configuration - add encryptionKey for sensitive data (CWE-312)"
    languages: [swift]
    severity: INFO
    metadata:
      cwe: "CWE-312"
      tags: [insecure-storage]

  - id: swift-sqlite-open
    pattern: 'sqlite3_open($PATH, ...)'
    message: "Swift SQLite - use SQLCipher for encrypted database storage (CWE-312)"
    languages: [swift]
    severity: INFO
    metadata:
      cwe: "CWE-312"
      tags: [insecure-storage]

  - id: swift-yap-database
    pattern: 'YapDatabase(path: $PATH)'
    message: "Swift YapDatabase - verify encryption for sensitive data (CWE-312)"
    languages: [swift]
    severity: INFO
    metadata:
      cwe: "CWE-312"
      tags: [insecure-storage]

  - id: swift-couchbase-lite
    pattern: 'Database(name: $NAME)'
    message: "Swift Couchbase Lite - verify encryption for sensitive data (CWE-312)"
    languages: [swift]
    severity: INFO
    metadata:
      cwe: "CWE-312"
      tags: [insecure-storage]

  # ============================================
  # WebView Security - Extended (iGoat-Swift Gap)
  # ============================================

  - id: swift-wkwebview-evaluate-js
    pattern: '$WEBVIEW.evaluateJavaScript($SCRIPT, ...)'
    message: "Swift WKWebView evaluateJavaScript - XSS risk if script contains user input (CWE-79)"
    languages: [swift]
    severity: WARNING
    metadata:
      cwe: "CWE-79"
      tags: [xss, webview]

  - id: swift-wkwebview-load-html
    pattern: '$WEBVIEW.loadHTMLString($HTML, baseURL: ...)'
    message: "Swift WKWebView loadHTMLString - XSS risk if HTML contains user input (CWE-79)"
    languages: [swift]
    severity: WARNING
    metadata:
      cwe: "CWE-79"
      tags: [xss, webview]

  - id: swift-wkwebview-file-access
    pattern: '$CONFIG.preferences.setValue(true, forKey: "allowFileAccessFromFileURLs")'
    message: "Swift WKWebView file access enabled - security risk (CWE-200)"
    languages: [swift]
    severity: ERROR
    metadata:
      cwe: "CWE-200"
      tags: [webview]

  # ============================================
  # URL Scheme Security (iGoat-Swift Gap)
  # ============================================

  - id: swift-url-scheme-handler
    pattern: 'func application($APP, open url: URL, ...)'
    message: "Swift URL scheme handler - validate URL parameters to prevent injection (CWE-20)"
    languages: [swift]
    severity: INFO
    metadata:
      cwe: "CWE-20"
      tags: [url-scheme]

  - id: swift-url-scheme-options
    pattern: 'func application($APP, open url: URL, options: ...)'
    message: "Swift URL scheme handler - validate URL parameters and source (CWE-20)"
    languages: [swift]
    severity: INFO
    metadata:
      cwe: "CWE-20"
      tags: [url-scheme]

  - id: swift-url-query-items
    pattern: 'URLComponents(url: $URL, ...)?.queryItems'
    message: "Swift URL query parsing - sanitize query parameters before use (CWE-20)"
    languages: [swift]
    severity: INFO
    metadata:
      cwe: "CWE-20"
      tags: [url-scheme]

  # ============================================
  # Keychain Misuse (iGoat-Swift Gap)
  # ============================================

  - id: swift-keychain-accessible-always
    pattern: 'kSecAttrAccessibleAlways'
    message: "Swift Keychain kSecAttrAccessibleAlways - data accessible when device locked (CWE-312)"
    languages: [swift]
    severity: ERROR
    metadata:
      cwe: "CWE-312"
      tags: [keychain]

  - id: swift-keychain-accessible-after-first-unlock
    pattern: 'kSecAttrAccessibleAfterFirstUnlock'
    message: "Swift Keychain kSecAttrAccessibleAfterFirstUnlock - consider more restrictive (CWE-312)"
    languages: [swift]
    severity: WARNING
    metadata:
      cwe: "CWE-312"
      tags: [keychain]

  - id: swift-keychain-no-acl
    pattern: 'SecItemAdd($QUERY, ...)'
    message: "Swift Keychain SecItemAdd - consider adding access control (CWE-312)"
    languages: [swift]
    severity: INFO
    metadata:
      cwe: "CWE-312"
      tags: [keychain]

  # ============================================
  # Weak Key Generation (iGoat-Swift Gap)
  # ============================================

  - id: swift-random-key
    pattern: 'arc4random_uniform($MAX)'
    message: "Swift arc4random_uniform not suitable for cryptographic keys - use SecRandomCopyBytes (CWE-338)"
    languages: [swift]
    severity: WARNING
    metadata:
      cwe: "CWE-338"
      tags: [crypto]

  - id: swift-uuid-as-key
    pattern: 'UUID().uuidString'
    message: "Swift UUID not suitable for cryptographic keys - use SecRandomCopyBytes (CWE-338)"
    languages: [swift]
    severity: INFO
    metadata:
      cwe: "CWE-338"
      tags: [crypto]

  - id: swift-date-seed
    pattern: 'srand48(Int(Date().timeIntervalSince1970))'
    message: "Swift date-seeded random not cryptographically secure (CWE-338)"
    languages: [swift]
    severity: WARNING
    metadata:
      cwe: "CWE-338"
      tags: [crypto]

  # ============================================
  # Cloud/Backend Security (iGoat-Swift Gap)
  # ============================================

  - id: swift-http-url
    pattern-regex: '"http://[^"]*"'
    message: "Swift HTTP URL detected - use HTTPS for secure communication (CWE-319)"
    languages: [swift]
    severity: WARNING
    metadata:
      cwe: "CWE-319"
      tags: [cleartext]

  - id: swift-hardcoded-endpoint
    pattern: 'let $VAR = "https://$DOMAIN/$PATH"'
    message: "Swift hardcoded backend URL - use configuration (CWE-798)"
    languages: [swift]
    severity: INFO
    metadata:
      cwe: "CWE-798"
      tags: [configuration]

  - id: swift-firebase-config
    pattern: 'FirebaseApp.configure()'
    message: "Swift Firebase - ensure google-services.plist is not exposed in repo (CWE-200)"
    languages: [swift]
    severity: INFO
    metadata:
      cwe: "CWE-200"
      tags: [cloud]

  # ============================================
  # Clipboard Security (iGoat-Swift Gap)
  # ============================================

  - id: swift-pasteboard-general
    pattern: 'UIPasteboard.general'
    message: "Swift general pasteboard - accessible by other apps, avoid for sensitive data (CWE-200)"
    languages: [swift]
    severity: INFO
    metadata:
      cwe: "CWE-200"
      tags: [clipboard]

  - id: swift-pasteboard-items
    pattern: 'UIPasteboard.general.items = $ITEMS'
    message: "Swift pasteboard items - sensitive data may be accessible to other apps (CWE-200)"
    languages: [swift]
    severity: WARNING
    metadata:
      cwe: "CWE-200"
      tags: [clipboard]

  # ============================================
  # Logging Security (iGoat-Swift Gap)
  # ============================================

  - id: swift-os-log-sensitive
    pattern: 'os_log($FORMAT, ..., $VALUE, ...)'
    message: "Swift os_log - use .private for sensitive data (CWE-532)"
    languages: [swift]
    severity: INFO
    metadata:
      cwe: "CWE-532"
      tags: [logging]

  - id: swift-logger-sensitive
    pattern: 'Logger().log($MSG)'
    message: "Swift Logger - ensure sensitive data uses .private (CWE-532)"
    languages: [swift]
    severity: INFO
    metadata:
      cwe: "CWE-532"
      tags: [logging]

  # =============================================================================
  # iOS App Transport Security (ATS) Bypass Detection
  # =============================================================================

  # URLSession allowing arbitrary HTTP loads
  - id: swift-urlsession-allows-insecure
    patterns:
      - pattern: 'URLSessionConfiguration.default.urlCache'
      - pattern: 'URLSession(configuration: $CONFIG)'
    message: "URLSession - verify ATS is not bypassed in Info.plist (CWE-319)"
    languages: [swift]
    severity: INFO
    metadata:
      cwe: "CWE-319"
      tags: [ats, igoat-swift, network-security]

  # Disabling certificate validation in URLSession
  - id: swift-urlsession-disable-cert-validation
    patterns:
      - pattern: 'urlSession(_: $SESSION, didReceive challenge: $CHALLENGE, completionHandler: $HANDLER)'
      - pattern: 'URLSession.shared.dataTask(with: $URL)'
    message: "URLSession delegate - ensure proper certificate validation (CWE-295)"
    languages: [swift]
    severity: WARNING
    metadata:
      cwe: "CWE-295"
      tags: [ats, certificate-validation, igoat-swift]

  # HTTP URLs in code (not HTTPS)
  - id: swift-http-url
    pattern-regex: 'URL\\(string:\\s*"http://[^"]*"'
    message: "HTTP URL in code - use HTTPS for secure transport (CWE-319)"
    languages: [swift]
    severity: WARNING
    metadata:
      cwe: "CWE-319"
      owasp: "A02:2021"
      tags: [ats, cleartext, igoat-swift]

  # ServerTrustPolicy.disableEvaluation (Alamofire)
  - id: swift-alamofire-disable-trust
    patterns:
      - pattern: 'ServerTrustPolicy.disableEvaluation'
      - pattern: '.disableEvaluation'
      - pattern: 'ServerTrustManager(evaluators: [$DOMAIN: DisabledEvaluator()])'
    message: "Alamofire server trust disabled - enables MITM attacks (CWE-295)"
    languages: [swift]
    severity: ERROR
    metadata:
      cwe: "CWE-295"
      tags: [ats, certificate-validation, alamofire]

  # Custom URLCredential without validation
  - id: swift-urlcredential-server-trust
    pattern: 'URLCredential(trust: $TRUST)'
    message: "URLCredential with server trust - validate certificate before accepting (CWE-295)"
    languages: [swift]
    severity: WARNING
    metadata:
      cwe: "CWE-295"
      tags: [ats, certificate-validation, igoat-swift]

  # Accepting all certificates
  - id: swift-accept-all-certs
    patterns:
      - pattern: 'completionHandler(.useCredential, $CREDENTIAL)'
      - pattern: 'completionHandler(URLSession.AuthChallengeDisposition.useCredential, ...)'
    message: "Accepting credential without validation - verify certificate chain (CWE-295)"
    languages: [swift]
    severity: WARNING
    metadata:
      cwe: "CWE-295"
      tags: [ats, certificate-validation]

  # SecTrustEvaluate bypass
  - id: swift-sectrust-bypass
    patterns:
      - pattern: 'SecTrustEvaluate($TRUST, &$RESULT)'
      - pattern: 'SecTrustEvaluateWithError($TRUST, nil)'
    message: "SecTrust evaluation - ensure result is checked and certificate is validated (CWE-295)"
    languages: [swift]
    severity: WARNING
    metadata:
      cwe: "CWE-295"
      tags: [ats, certificate-validation, igoat-swift]

  # WKWebView allowing insecure content
  - id: swift-wkwebview-insecure
    patterns:
      - pattern: 'WKWebViewConfiguration().preferences.javaScriptEnabled = true'
      - pattern: 'webView.load(URLRequest(url: URL(string: "http://$URL")!))'
    message: "WKWebView loading insecure content - use HTTPS URLs (CWE-319)"
    languages: [swift]
    severity: WARNING
    metadata:
      cwe: "CWE-319"
      tags: [ats, webview, igoat-swift]

  # CFStreamSSLLevel minimum TLS version
  - id: swift-cfstream-ssl-level
    pattern-regex: 'kCFStreamSSLLevel|CFStreamProperty.*SSL'
    message: "CFStream SSL level - ensure TLS 1.2+ is enforced (CWE-326)"
    languages: [swift]
    severity: INFO
    metadata:
      cwe: "CWE-326"
      tags: [ats, tls]

  # =============================================================================
  # iOS Data Protection & Secure Storage
  # =============================================================================

  # FileProtectionType None
  - id: swift-file-protection-none
    patterns:
      - pattern: '.noFileProtection'
      - pattern: 'FileProtectionType.none'
    message: "File protection disabled - use .complete or .completeUnlessOpen (CWE-311)"
    languages: [swift]
    severity: ERROR
    metadata:
      cwe: "CWE-311"
      tags: [data-protection, igoat-swift]

  # UserDefaults for sensitive data
  - id: swift-userdefaults-sensitive
    patterns:
      - pattern: 'UserDefaults.standard.set($VALUE, forKey: "password")'
      - pattern: 'UserDefaults.standard.set($VALUE, forKey: "token")'
      - pattern: 'UserDefaults.standard.set($VALUE, forKey: "secret")'
      - pattern: 'UserDefaults.standard.set($VALUE, forKey: "apiKey")'
    message: "Sensitive data in UserDefaults - use Keychain for secrets (CWE-312)"
    languages: [swift]
    severity: ERROR
    metadata:
      cwe: "CWE-312"
      owasp: "A02:2021"
      tags: [data-protection, insecure-storage, igoat-swift]

  # Keychain without accessibility attribute
  - id: swift-keychain-accessibility
    patterns:
      - pattern: 'SecItemAdd($QUERY, nil)'
      - pattern: 'SecItemUpdate($QUERY, $ATTRS)'
    message: "Keychain operation - set kSecAttrAccessible to appropriate protection level (CWE-312)"
    languages: [swift]
    severity: INFO
    metadata:
      cwe: "CWE-312"
      tags: [keychain, data-protection, igoat-swift]

  # kSecAttrAccessibleAlways (deprecated, insecure)
  - id: swift-keychain-accessible-always
    pattern-regex: 'kSecAttrAccessibleAlways|kSecAttrAccessibleAlwaysThisDeviceOnly'
    message: "kSecAttrAccessibleAlways is deprecated and insecure - use kSecAttrAccessibleWhenUnlockedThisDeviceOnly (CWE-312)"
    languages: [swift]
    severity: ERROR
    metadata:
      cwe: "CWE-312"
      tags: [keychain, data-protection, igoat-swift]

  # =============================================================================
  # iOS URL Scheme Hijacking
  # =============================================================================

  # Custom URL scheme handler
  - id: swift-url-scheme-handler
    patterns:
      - pattern: 'application(_: $APP, open url: $URL, ...)'
      - pattern: 'canOpenURL($URL)'
      - pattern: 'open($URL, options: ...)'
    message: "URL scheme handler - validate URL origin and parameters to prevent hijacking (CWE-939)"
    languages: [swift]
    severity: WARNING
    metadata:
      cwe: "CWE-939"
      tags: [url-scheme, igoat-swift]

  # Deep link validation
  - id: swift-deeplink-validation
    pattern: 'UIApplication.shared.open($URL)'
    message: "Deep link handling - validate URL before processing (CWE-601)"
    languages: [swift]
    severity: WARNING
    metadata:
      cwe: "CWE-601"
      tags: [url-scheme, deeplink, igoat-swift]
