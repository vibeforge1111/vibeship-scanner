[phases.setup]
nixPkgs = ["python311", "git", "curl", "wget"]

[phases.install]
cmds = [
    "pip install -r requirements.txt",
    "curl -fsSL https://raw.githubusercontent.com/opengrep/opengrep/main/install.sh | bash && ln -s ~/.opengrep/cli/latest/opengrep /usr/local/bin/opengrep",
    "curl -sfL https://raw.githubusercontent.com/aquasecurity/trivy/main/contrib/install.sh | sh -s -- -b /usr/local/bin v0.48.0",
    "wget -qO- https://github.com/gitleaks/gitleaks/releases/download/v8.18.1/gitleaks_8.18.1_linux_x64.tar.gz | tar xz -C /usr/local/bin"
]

[start]
cmd = "gunicorn --bind 0.0.0.0:$PORT --workers 2 --threads 4 server:app"
