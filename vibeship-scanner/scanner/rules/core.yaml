rules:
  - id: eval-user-input
    pattern: eval(...)
    message: Dangerous eval() call detected - potential code injection
    languages: [javascript, typescript]
    severity: ERROR

  - id: innerhtml-assignment
    pattern: $X.innerHTML = $Y
    message: innerHTML assignment - potential XSS vulnerability
    languages: [javascript, typescript]
    severity: ERROR

  - id: document-write
    pattern: document.write(...)
    message: document.write() usage - potential XSS vulnerability
    languages: [javascript, typescript]
    severity: ERROR

  - id: exec-call
    pattern: exec(...)
    message: Command execution detected - potential command injection
    languages: [javascript, typescript]
    severity: ERROR

  - id: execsync-call
    pattern: execSync(...)
    message: Synchronous command execution - potential command injection
    languages: [javascript, typescript]
    severity: ERROR

  - id: child-process-exec
    pattern: child_process.exec(...)
    message: child_process.exec() - potential command injection
    languages: [javascript, typescript]
    severity: ERROR

  - id: fs-readfile-query
    pattern: fs.readFile(req.query.$X, ...)
    message: Reading file from user input - potential path traversal
    languages: [javascript, typescript]
    severity: ERROR

  - id: fs-readfilesync-query
    pattern: fs.readFileSync(req.query.$X)
    message: Reading file from user input - potential path traversal
    languages: [javascript, typescript]
    severity: ERROR

  - id: fs-readfile-body
    pattern: fs.readFile(req.body.$X, ...)
    message: Reading file from user input - potential path traversal
    languages: [javascript, typescript]
    severity: ERROR

  - id: fs-readfilesync-body
    pattern: fs.readFileSync(req.body.$X)
    message: Reading file from user input - potential path traversal
    languages: [javascript, typescript]
    severity: ERROR

  - id: redirect-query
    pattern: res.redirect(req.query.$X)
    message: Redirect using user input - potential open redirect
    languages: [javascript, typescript]
    severity: WARNING

  - id: redirect-body
    pattern: res.redirect(req.body.$X)
    message: Redirect using user input - potential open redirect
    languages: [javascript, typescript]
    severity: WARNING

  - id: weak-hash-md5
    pattern: 'crypto.createHash("md5")'
    message: MD5 is a weak hash function
    languages: [javascript, typescript]
    severity: WARNING

  - id: weak-hash-sha1
    pattern: 'crypto.createHash("sha1")'
    message: SHA1 is a weak hash function
    languages: [javascript, typescript]
    severity: WARNING

  - id: tls-reject-unauthorized
    pattern: rejectUnauthorized = false
    message: TLS certificate verification disabled
    languages: [javascript, typescript]
    severity: ERROR

  - id: python-os-system
    pattern: os.system(...)
    message: os.system() call - potential command injection
    languages: [python]
    severity: ERROR

  - id: python-pickle-loads
    pattern: pickle.loads(...)
    message: pickle.loads() - insecure deserialization
    languages: [python]
    severity: ERROR

  - id: python-yaml-unsafe
    pattern: yaml.load($DATA)
    message: yaml.load() without Loader - insecure deserialization
    languages: [python]
    severity: ERROR

  - id: python-sql-format
    pattern: cursor.execute($Q % $V)
    message: SQL query with string formatting - SQL injection risk
    languages: [python]
    severity: ERROR

  - id: python-sql-concat
    pattern: cursor.execute($Q + $V)
    message: SQL query with string concatenation - SQL injection risk
    languages: [python]
    severity: ERROR

  - id: new-function
    pattern: new Function(...)
    message: new Function() - potential code injection
    languages: [javascript, typescript]
    severity: ERROR

  - id: dangerously-set-inner-html
    pattern: dangerouslySetInnerHTML={...}
    message: React dangerouslySetInnerHTML - XSS risk
    languages: [javascript, typescript]
    severity: ERROR

  - id: php-shell-exec
    pattern: shell_exec(...)
    message: PHP shell_exec() - command injection risk
    languages: [php]
    severity: ERROR

  - id: php-exec
    pattern: exec(...)
    message: PHP exec() - command injection risk
    languages: [php]
    severity: ERROR

  - id: php-system
    pattern: system(...)
    message: PHP system() - command injection risk
    languages: [php]
    severity: ERROR

  - id: php-passthru
    pattern: passthru(...)
    message: PHP passthru() - command injection risk
    languages: [php]
    severity: ERROR

  - id: php-popen
    pattern: popen(...)
    message: PHP popen() - command injection risk
    languages: [php]
    severity: ERROR

  - id: php-proc-open
    pattern: proc_open(...)
    message: PHP proc_open() - command injection risk
    languages: [php]
    severity: ERROR

  - id: php-backtick
    pattern: '`$CMD`'
    message: PHP backtick execution - command injection risk
    languages: [php]
    severity: ERROR

  - id: php-eval
    pattern: eval(...)
    message: PHP eval() - code injection risk
    languages: [php]
    severity: ERROR

  - id: php-assert
    pattern: assert(...)
    message: PHP assert() with string - code injection risk
    languages: [php]
    severity: ERROR

  - id: php-create-function
    pattern: create_function(...)
    message: PHP create_function() - code injection risk (deprecated)
    languages: [php]
    severity: ERROR

  - id: php-preg-replace-e
    pattern: 'preg_replace("/.*/e", ...)'
    message: PHP preg_replace with /e modifier - code injection
    languages: [php]
    severity: ERROR

  - id: php-include-var
    pattern: include($X)
    message: PHP include with variable - file inclusion risk
    languages: [php]
    severity: ERROR

  - id: php-include-once-var
    pattern: include_once($X)
    message: PHP include_once with variable - file inclusion risk
    languages: [php]
    severity: ERROR

  - id: php-require-var
    pattern: require($X)
    message: PHP require with variable - file inclusion risk
    languages: [php]
    severity: ERROR

  - id: php-require-once-var
    pattern: require_once($X)
    message: PHP require_once with variable - file inclusion risk
    languages: [php]
    severity: ERROR

  - id: php-mysqli-query-concat
    pattern: mysqli_query($CONN, $Q . $V)
    message: PHP SQL injection via string concatenation
    languages: [php]
    severity: ERROR

  - id: php-mysql-query
    pattern: mysql_query(...)
    message: PHP mysql_query() - deprecated and SQL injection risk
    languages: [php]
    severity: ERROR

  - id: php-echo-get
    pattern: echo $_GET[$X]
    message: PHP XSS - echoing GET parameter without escaping
    languages: [php]
    severity: ERROR

  - id: php-echo-post
    pattern: echo $_POST[$X]
    message: PHP XSS - echoing POST parameter without escaping
    languages: [php]
    severity: ERROR

  - id: php-echo-request
    pattern: echo $_REQUEST[$X]
    message: PHP XSS - echoing REQUEST parameter without escaping
    languages: [php]
    severity: ERROR

  - id: php-print-get
    pattern: print $_GET[$X]
    message: PHP XSS - printing GET parameter without escaping
    languages: [php]
    severity: ERROR

  - id: php-print-post
    pattern: print $_POST[$X]
    message: PHP XSS - printing POST parameter without escaping
    languages: [php]
    severity: ERROR

  - id: php-unserialize
    pattern: unserialize(...)
    message: PHP unserialize() - insecure deserialization risk
    languages: [php]
    severity: ERROR

  - id: php-md5-password
    pattern: md5($PASSWORD)
    message: PHP MD5 for password - use password_hash() instead
    languages: [php]
    severity: WARNING

  - id: php-sha1-password
    pattern: sha1($PASSWORD)
    message: PHP SHA1 for password - use password_hash() instead
    languages: [php]
    severity: WARNING

  - id: php-file-get-contents-url
    pattern: file_get_contents($URL)
    message: PHP file_get_contents with URL - potential SSRF
    languages: [php]
    severity: WARNING

  - id: php-curl-ssl-verify-off
    pattern: 'curl_setopt($CH, CURLOPT_SSL_VERIFYPEER, false)'
    message: PHP cURL SSL verification disabled
    languages: [php]
    severity: ERROR

  - id: php-extract
    pattern: extract(...)
    message: PHP extract() - variable injection risk
    languages: [php]
    severity: WARNING

  - id: php-parse-str
    pattern: parse_str($X)
    message: PHP parse_str() without second param - variable injection
    languages: [php]
    severity: WARNING

  - id: php-move-uploaded-file
    pattern: move_uploaded_file(...)
    message: PHP file upload - ensure proper validation
    languages: [php]
    severity: WARNING

  - id: php-header-redirect
    pattern: 'header("Location: " . $X)'
    message: PHP open redirect risk
    languages: [php]
    severity: WARNING

  - id: php-query-get-concat
    pattern: $QUERY . $_GET[$X]
    message: PHP SQL injection - concatenating GET parameter into query
    languages: [php]
    severity: ERROR

  - id: php-query-post-concat
    pattern: $QUERY . $_POST[$X]
    message: PHP SQL injection - concatenating POST parameter into query
    languages: [php]
    severity: ERROR

  - id: php-query-request-concat
    pattern: $QUERY . $_REQUEST[$X]
    message: PHP SQL injection - concatenating REQUEST parameter into query
    languages: [php]
    severity: ERROR

  - id: php-query-interpolation
    pattern: '"SELECT $EXPR FROM $TABLE WHERE $FIELD = $_GET[$X]"'
    message: PHP SQL injection via string interpolation
    languages: [php]
    severity: ERROR

  - id: php-preg-replace-callback
    pattern: preg_replace_callback($PATTERN, $CALLBACK, $_GET[$X])
    message: PHP ReDoS risk - user input in regex
    languages: [php]
    severity: WARNING

  - id: php-preg-match-input
    pattern: preg_match($_GET[$X], ...)
    message: PHP ReDoS risk - user-controlled regex pattern
    languages: [php]
    severity: ERROR

  - id: php-header-injection
    pattern: 'header($X . $_GET[$Y])'
    message: PHP header injection - user input in header
    languages: [php]
    severity: ERROR

  - id: php-mail-injection
    pattern: mail($_GET[$X], ...)
    message: PHP mail header injection risk
    languages: [php]
    severity: ERROR

  - id: php-mail-body-injection
    pattern: mail($TO, $SUBJECT, $_GET[$X])
    message: PHP mail content injection risk
    languages: [php]
    severity: WARNING

  - id: php-fopen-input
    pattern: fopen($_GET[$X], ...)
    message: PHP path traversal - user input in file path
    languages: [php]
    severity: ERROR

  - id: php-file-input
    pattern: file($_GET[$X])
    message: PHP path traversal - user input in file path
    languages: [php]
    severity: ERROR

  - id: php-readfile-input
    pattern: readfile($_GET[$X])
    message: PHP path traversal - user input in readfile
    languages: [php]
    severity: ERROR

  - id: php-file-put-contents-input
    pattern: file_put_contents($_GET[$X], ...)
    message: PHP arbitrary file write via user input
    languages: [php]
    severity: ERROR

  - id: php-copy-input
    pattern: copy($_GET[$X], ...)
    message: PHP arbitrary file copy via user input
    languages: [php]
    severity: ERROR

  - id: php-rename-input
    pattern: rename($_GET[$X], ...)
    message: PHP arbitrary file rename via user input
    languages: [php]
    severity: ERROR

  - id: php-unlink-input
    pattern: unlink($_GET[$X])
    message: PHP arbitrary file delete via user input
    languages: [php]
    severity: ERROR

  - id: php-mkdir-input
    pattern: mkdir($_GET[$X])
    message: PHP arbitrary directory creation via user input
    languages: [php]
    severity: WARNING

  - id: php-rmdir-input
    pattern: rmdir($_GET[$X])
    message: PHP arbitrary directory deletion via user input
    languages: [php]
    severity: ERROR

  - id: php-chmod-input
    pattern: chmod($_GET[$X], ...)
    message: PHP arbitrary permission change via user input
    languages: [php]
    severity: ERROR

  - id: php-ldap-search-input
    pattern: ldap_search($CONN, $BASE, $_GET[$X])
    message: PHP LDAP injection - user input in search filter
    languages: [php]
    severity: ERROR

  - id: php-xpath-input
    pattern: $XML->xpath($_GET[$X])
    message: PHP XPath injection - user input in XPath query
    languages: [php]
    severity: ERROR

  - id: php-simplexml-load
    pattern: simplexml_load_string($_GET[$X])
    message: PHP XXE risk - loading XML from user input
    languages: [php]
    severity: ERROR

  - id: php-dom-loadxml
    pattern: $DOC->loadXML($_GET[$X])
    message: PHP XXE risk - loading XML from user input
    languages: [php]
    severity: ERROR

  - id: php-json-decode-depth
    pattern: json_decode($_GET[$X])
    message: PHP JSON parsing user input - ensure depth limits
    languages: [php]
    severity: WARNING

  - id: php-base64-decode-exec
    pattern: eval(base64_decode($X))
    message: PHP code injection via base64 decode
    languages: [php]
    severity: ERROR

  - id: php-preg-replace-e-flag
    pattern: 'preg_replace($PATTERN, $REPLACEMENT, $SUBJECT, $LIMIT)'
    message: PHP preg_replace - check for dangerous /e modifier
    languages: [php]
    severity: WARNING

  - id: php-usort-callback
    pattern: usort($ARRAY, $_GET[$X])
    message: PHP code injection via callback
    languages: [php]
    severity: ERROR

  - id: php-array-map-callback
    pattern: array_map($_GET[$X], ...)
    message: PHP code injection via callback
    languages: [php]
    severity: ERROR

  - id: php-call-user-func
    pattern: call_user_func($_GET[$X], ...)
    message: PHP code injection via call_user_func
    languages: [php]
    severity: ERROR

  - id: php-call-user-func-array
    pattern: call_user_func_array($_GET[$X], ...)
    message: PHP code injection via call_user_func_array
    languages: [php]
    severity: ERROR

  - id: php-var-var
    pattern: $$_GET[$X]
    message: PHP variable variable injection
    languages: [php]
    severity: ERROR

  - id: php-compact-input
    pattern: compact($_GET[$X])
    message: PHP variable injection via compact
    languages: [php]
    severity: WARNING

  - id: php-setcookie-httponly-false
    pattern: 'setcookie($NAME, $VALUE, $EXPIRE, $PATH, $DOMAIN, $SECURE, false)'
    message: PHP cookie without HttpOnly flag
    languages: [php]
    severity: WARNING

  - id: php-session-regenerate-missing
    pattern: session_start()
    message: PHP session - ensure session_regenerate_id() after login
    languages: [php]
    severity: INFO

  - id: php-rand-crypto
    pattern: rand()
    message: PHP rand() not cryptographically secure - use random_int()
    languages: [php]
    severity: WARNING

  - id: php-mt-rand-crypto
    pattern: mt_rand()
    message: PHP mt_rand() not cryptographically secure - use random_int()
    languages: [php]
    severity: WARNING

  - id: php-substr-token
    pattern: substr(md5($X), ...)
    message: PHP weak token generation - use random_bytes()
    languages: [php]
    severity: WARNING

  - id: php-strcmp-bypass
    pattern: strcmp($_GET[$X], $SECRET)
    message: PHP strcmp type juggling bypass risk
    languages: [php]
    severity: WARNING

  - id: php-loose-comparison
    pattern: $X == $_GET[$Y]
    message: PHP loose comparison - consider strict === for security
    languages: [php]
    severity: INFO

  - id: ruby-system-call
    pattern: system($CMD)
    message: Ruby system() - command injection risk
    languages: [ruby]
    severity: ERROR

  - id: ruby-exec-call
    pattern: exec($CMD)
    message: Ruby exec() - command injection risk
    languages: [ruby]
    severity: ERROR

  - id: ruby-backtick
    pattern: '`$CMD`'
    message: Ruby backtick execution - command injection risk
    languages: [ruby]
    severity: ERROR

  - id: ruby-eval
    pattern: eval($CODE)
    message: Ruby eval() - code injection risk
    languages: [ruby]
    severity: ERROR

  - id: ruby-send-dynamic
    pattern: $OBJ.send(params[$X], ...)
    message: Ruby dynamic send - code injection risk
    languages: [ruby]
    severity: ERROR

  - id: ruby-constantize
    pattern: params[$X].constantize
    message: Ruby constantize - arbitrary class instantiation
    languages: [ruby]
    severity: ERROR

  - id: ruby-yaml-load
    pattern: YAML.load($DATA)
    message: Ruby YAML.load - insecure deserialization (use safe_load)
    languages: [ruby]
    severity: ERROR

  - id: ruby-marshal-load
    pattern: Marshal.load($DATA)
    message: Ruby Marshal.load - insecure deserialization
    languages: [ruby]
    severity: ERROR

  - id: ruby-erb-render
    pattern: ERB.new(params[$X]).result
    message: Ruby ERB template injection
    languages: [ruby]
    severity: ERROR

  - id: ruby-render-inline
    pattern: 'render inline: params[$X]'
    message: Ruby Rails inline render - template injection
    languages: [ruby]
    severity: ERROR

  - id: ruby-sql-interpolation
    pattern: where("$FIELD = #{params[$X]}")
    message: Ruby SQL injection via string interpolation
    languages: [ruby]
    severity: ERROR

  - id: ruby-open-uri
    pattern: open(params[$X])
    message: Ruby open() with user input - SSRF/command injection
    languages: [ruby]
    severity: ERROR

  - id: ruby-redirect-to-params
    pattern: redirect_to params[$X]
    message: Ruby open redirect risk
    languages: [ruby]
    severity: WARNING

  - id: go-sql-query-concat
    pattern: db.Query($Q + $INPUT)
    message: Go SQL injection via concatenation
    languages: [go]
    severity: ERROR

  - id: go-exec-command
    pattern: exec.Command($CMD, ...)
    message: Go command execution - ensure input validation
    languages: [go]
    severity: WARNING

  - id: go-template-html
    pattern: template.HTML($INPUT)
    message: Go template.HTML bypasses escaping - XSS risk
    languages: [go]
    severity: ERROR

  - id: go-tls-insecure
    pattern: 'InsecureSkipVerify: true'
    message: Go TLS verification disabled
    languages: [go]
    severity: ERROR

  - id: go-yaml-unmarshal
    pattern: yaml.Unmarshal($DATA, ...)
    message: Go YAML unmarshal - check for safe parsing
    languages: [go]
    severity: WARNING

  - id: java-runtime-exec
    pattern: Runtime.getRuntime().exec($CMD)
    message: Java command execution - injection risk
    languages: [java]
    severity: ERROR

  - id: java-processbuilder
    pattern: new ProcessBuilder($CMD)
    message: Java ProcessBuilder - command injection risk
    languages: [java]
    severity: WARNING

  - id: java-statement-execute
    pattern: $STMT.execute($QUERY)
    message: Java SQL - use PreparedStatement instead
    languages: [java]
    severity: WARNING

  - id: java-xpath-compile
    pattern: XPathFactory.newInstance().newXPath().compile($EXPR)
    message: Java XPath injection risk
    languages: [java]
    severity: WARNING

  - id: java-xxe-documentbuilder
    pattern: DocumentBuilderFactory.newInstance()
    message: Java XXE risk - disable external entities
    languages: [java]
    severity: WARNING

  - id: java-deserialization
    pattern: new ObjectInputStream($STREAM).readObject()
    message: Java insecure deserialization
    languages: [java]
    severity: ERROR

  - id: java-crypto-ecb
    pattern: 'Cipher.getInstance("AES/ECB/$PADDING")'
    message: Java ECB mode is insecure - use GCM or CBC
    languages: [java]
    severity: ERROR

  - id: java-crypto-des
    pattern: 'Cipher.getInstance("DES")'
    message: Java DES is weak - use AES
    languages: [java]
    severity: ERROR

  - id: java-random-security
    pattern: new Random()
    message: Java Random not secure - use SecureRandom
    languages: [java]
    severity: WARNING

  - id: java-md5-hash
    pattern: 'MessageDigest.getInstance("MD5")'
    message: Java MD5 is weak for security purposes
    languages: [java]
    severity: WARNING

  - id: java-sha1-hash
    pattern: 'MessageDigest.getInstance("SHA-1")'
    message: Java SHA-1 is deprecated for security
    languages: [java]
    severity: WARNING

  - id: csharp-sql-concat
    pattern: $CMD.CommandText = $Q + $INPUT
    message: C# SQL injection via concatenation
    languages: [csharp]
    severity: ERROR

  - id: csharp-process-start
    pattern: Process.Start($CMD)
    message: C# command execution - injection risk
    languages: [csharp]
    severity: WARNING

  - id: csharp-deserialization
    pattern: BinaryFormatter().Deserialize($STREAM)
    message: C# BinaryFormatter deserialization is insecure
    languages: [csharp]
    severity: ERROR

  - id: csharp-xxe-xmlreader
    pattern: XmlReader.Create($INPUT)
    message: C# XXE risk - configure XmlReaderSettings
    languages: [csharp]
    severity: WARNING

  - id: csharp-regex-timeout
    pattern: new Regex($PATTERN)
    message: C# Regex without timeout - ReDoS risk
    languages: [csharp]
    severity: WARNING

  # =====================================================
  # PHP - Enhanced SQL Injection Detection (DVWA patterns)
  # =====================================================

  - id: php-sql-string-var-interpolation
    pattern: '"SELECT ... FROM ... WHERE ... = $VAR"'
    message: PHP SQL injection - variable interpolated in query string
    languages: [php]
    severity: ERROR

  - id: php-sql-double-quote-var
    pattern: '"... WHERE ... = $ID"'
    message: PHP SQL injection - variable in WHERE clause
    languages: [php]
    severity: ERROR

  - id: php-mysqli-query-var
    pattern: mysqli_query($CONN, $QUERY)
    message: PHP SQL query - ensure parameterized queries are used
    languages: [php]
    severity: WARNING

  - id: php-pdo-query-var
    pattern: $PDO->query($QUERY)
    message: PHP PDO query() - use prepare() with bound parameters instead
    languages: [php]
    severity: WARNING

  - id: php-pdo-exec-var
    pattern: $PDO->exec($QUERY)
    message: PHP PDO exec() - use prepare() with bound parameters instead
    languages: [php]
    severity: WARNING

  # =====================================================
  # PHP - Enhanced XSS Detection (DVWA patterns)
  # =====================================================

  - id: php-echo-concat-get
    pattern: echo $X . $_GET[$Y]
    message: PHP XSS - echoing concatenated GET parameter
    languages: [php]
    severity: ERROR

  - id: php-echo-concat-get-2
    pattern: echo $_GET[$X] . $Y
    message: PHP XSS - echoing concatenated GET parameter
    languages: [php]
    severity: ERROR

  - id: php-echo-concat-post
    pattern: echo $X . $_POST[$Y]
    message: PHP XSS - echoing concatenated POST parameter
    languages: [php]
    severity: ERROR

  - id: php-echo-concat-post-2
    pattern: echo $_POST[$X] . $Y
    message: PHP XSS - echoing concatenated POST parameter
    languages: [php]
    severity: ERROR

  - id: php-string-concat-get
    pattern: $HTML .= $X . $_GET[$Y]
    message: PHP XSS - user input concatenated into output variable
    languages: [php]
    severity: ERROR

  - id: php-string-concat-get-2
    pattern: $HTML .= $_GET[$X]
    message: PHP XSS - GET parameter appended to output
    languages: [php]
    severity: ERROR

  - id: php-string-concat-post
    pattern: $HTML .= $_POST[$X]
    message: PHP XSS - POST parameter appended to output
    languages: [php]
    severity: ERROR

  - id: php-printf-get
    pattern: printf($FMT, $_GET[$X])
    message: PHP XSS - printing GET parameter via printf
    languages: [php]
    severity: ERROR

  - id: php-sprintf-get
    pattern: sprintf($FMT, $_GET[$X])
    message: PHP XSS - GET parameter in sprintf (check output escaping)
    languages: [php]
    severity: WARNING

  # =====================================================
  # PHP - Enhanced Command Injection (DVWA patterns)
  # =====================================================

  - id: php-shell-exec-concat
    pattern: shell_exec($CMD . $VAR)
    message: PHP command injection - variable concatenated to shell command
    languages: [php]
    severity: ERROR

  - id: php-shell-exec-concat-2
    pattern: shell_exec($X . $Y . $Z)
    message: PHP command injection - string concatenation in shell command
    languages: [php]
    severity: ERROR

  - id: php-exec-concat
    pattern: exec($CMD . $VAR)
    message: PHP command injection - variable concatenated to exec
    languages: [php]
    severity: ERROR

  - id: php-system-concat
    pattern: system($CMD . $VAR)
    message: PHP command injection - variable concatenated to system
    languages: [php]
    severity: ERROR

  - id: php-passthru-concat
    pattern: passthru($CMD . $VAR)
    message: PHP command injection - variable concatenated to passthru
    languages: [php]
    severity: ERROR

  - id: php-popen-concat
    pattern: popen($CMD . $VAR, $MODE)
    message: PHP command injection - variable concatenated to popen
    languages: [php]
    severity: ERROR

  - id: php-proc-open-concat
    pattern: proc_open($CMD . $VAR, ...)
    message: PHP command injection - variable concatenated to proc_open
    languages: [php]
    severity: ERROR

  - id: php-backtick-var
    pattern: '`$CMD $VAR`'
    message: PHP command injection - variable in backtick execution
    languages: [php]
    severity: ERROR

  # =====================================================
  # PHP - File Upload Vulnerabilities (DVWA patterns)
  # =====================================================

  - id: php-upload-no-type-check
    pattern: move_uploaded_file($_FILES[$X]['tmp_name'], $DEST)
    message: PHP file upload - verify file type validation exists
    languages: [php]
    severity: WARNING

  - id: php-upload-user-filename
    pattern: $_FILES[$X]['name']
    message: PHP file upload - user-controlled filename (sanitize before use)
    languages: [php]
    severity: WARNING

  # =====================================================
  # PHP - Session/Auth Weaknesses
  # =====================================================

  - id: php-setcookie-no-httponly
    pattern: setcookie($NAME, $VALUE)
    message: PHP cookie - missing httponly/secure flags
    languages: [php]
    severity: WARNING

  - id: php-setcookie-no-secure
    pattern: setcookie($NAME, $VALUE, $EXPIRE)
    message: PHP cookie - missing httponly/secure flags
    languages: [php]
    severity: WARNING

  - id: php-password-plain-compare
    pattern: if ($PASSWORD == $X)
    message: PHP password - use password_verify() instead of direct comparison
    languages: [php]
    severity: ERROR

  - id: php-password-plain-compare-2
    pattern: if ($X == $PASSWORD)
    message: PHP password - use password_verify() instead of direct comparison
    languages: [php]
    severity: ERROR

  # =====================================================
  # PHP - CSRF Token Missing Indicators
  # =====================================================

  - id: php-form-no-token-check
    pattern: 'if(isset($_POST[$X])) { ... }'
    message: PHP form handler - verify CSRF token validation exists
    languages: [php]
    severity: INFO

  # =====================================================
  # PHP - Dangerous Functions Expanded
  # =====================================================

  - id: php-assert-user-input
    pattern: assert($_GET[$X])
    message: PHP code injection via assert() with user input
    languages: [php]
    severity: ERROR

  - id: php-assert-user-input-post
    pattern: assert($_POST[$X])
    message: PHP code injection via assert() with user input
    languages: [php]
    severity: ERROR

  - id: php-array-filter-callback
    pattern: array_filter($ARRAY, $_GET[$X])
    message: PHP code injection via array_filter callback
    languages: [php]
    severity: ERROR

  # =====================================================
  # PHP - Information Disclosure
  # =====================================================

  - id: php-phpinfo
    pattern: phpinfo()
    message: PHP phpinfo() exposes sensitive server configuration
    languages: [php]
    severity: WARNING

  - id: php-error-reporting-all
    pattern: error_reporting(E_ALL)
    message: PHP verbose error reporting - disable in production
    languages: [php]
    severity: INFO

  - id: php-display-errors-on
    pattern: 'ini_set("display_errors", "1")'
    message: PHP display_errors enabled - disable in production
    languages: [php]
    severity: WARNING

  - id: php-var-dump-output
    pattern: var_dump($X)
    message: PHP var_dump() - remove debug output in production
    languages: [php]
    severity: INFO

  - id: php-print-r-output
    pattern: print_r($X)
    message: PHP print_r() - remove debug output in production
    languages: [php]
    severity: INFO

  # =====================================================
  # PHP - Database Specific
  # =====================================================

  - id: php-mysql-real-escape-only
    pattern: mysql_real_escape_string($X)
    message: PHP mysql_real_escape_string is deprecated - use prepared statements
    languages: [php]
    severity: WARNING

  - id: php-mysqli-real-escape-only
    pattern: mysqli_real_escape_string($CONN, $X)
    message: PHP escaping alone is insufficient - use prepared statements
    languages: [php]
    severity: WARNING

  - id: php-addslashes-sql
    pattern: addslashes($X)
    message: PHP addslashes() is not safe for SQL - use prepared statements
    languages: [php]
    severity: WARNING

  # =====================================================
  # PHP - Crypto Weaknesses
  # =====================================================

  - id: php-uniqid-token
    pattern: uniqid()
    message: PHP uniqid() is predictable - use random_bytes() for tokens
    languages: [php]
    severity: WARNING

  - id: php-mcrypt-deprecated
    pattern: mcrypt_encrypt(...)
    message: PHP mcrypt is deprecated - use openssl_encrypt()
    languages: [php]
    severity: WARNING

  - id: php-des-encryption
    pattern: MCRYPT_DES
    message: PHP DES encryption is weak - use AES-256
    languages: [php]
    severity: ERROR

  - id: php-ecb-mode
    pattern: MCRYPT_MODE_ECB
    message: PHP ECB mode is insecure - use CBC or GCM
    languages: [php]
    severity: ERROR

  # =====================================================
  # Hardcoded Credentials Detection (DVWA-specific patterns)
  # =====================================================

  - id: php-hardcoded-password-check
    pattern: if ($PASSWORD == "...")
    message: Hardcoded password in authentication check (CWE-798)
    languages: [php]
    severity: ERROR

  - id: php-hardcoded-password-check-2
    pattern: if ("..." == $PASSWORD)
    message: Hardcoded password in authentication check (CWE-798)
    languages: [php]
    severity: ERROR

  - id: php-hardcoded-username-password
    pattern: if ($USERNAME == "..." && $PASSWORD == "...")
    message: Hardcoded credentials in authentication (CWE-798)
    languages: [php]
    severity: ERROR

  - id: php-hardcoded-password-var
    pattern: $PASSWORD = "..."
    message: Hardcoded password assignment (CWE-798)
    languages: [php]
    severity: WARNING

  - id: php-hardcoded-secret-var
    pattern: $SECRET = "..."
    message: Hardcoded secret assignment (CWE-798)
    languages: [php]
    severity: WARNING

  - id: php-hardcoded-api-key
    pattern: $API_KEY = "..."
    message: Hardcoded API key (CWE-798)
    languages: [php]
    severity: ERROR

  # DVWA-specific: Hardcoded username/password comparison
  - id: php-hardcoded-creds-username-password
    pattern: 'if ($username == "..." && $password == "...")'
    message: Hardcoded credentials - username and password comparison (CWE-798)
    languages: [php]
    severity: ERROR

  # DVWA-specific: OAuth client credentials
  - id: php-hardcoded-client-secret
    pattern: 'if ($client_id == "..." && $client_secret == "...")'
    message: Hardcoded OAuth client credentials (CWE-798)
    languages: [php]
    severity: ERROR

  - id: php-client-secret-comparison
    pattern: '$client_secret == "..."'
    message: Hardcoded client secret comparison (CWE-798)
    languages: [php]
    severity: ERROR

  # PHP Class Constants with secrets
  - id: php-const-token-secret
    pattern: 'private const ACCESS_TOKEN_SECRET = "..."'
    message: Hardcoded access token secret in class constant (CWE-798)
    languages: [php]
    severity: ERROR

  - id: php-const-refresh-token-secret
    pattern: 'private const REFRESH_TOKEN_SECRET = "..."'
    message: Hardcoded refresh token secret in class constant (CWE-798)
    languages: [php]
    severity: ERROR

  - id: php-const-encryption-key
    pattern: 'private const ENCRYPTION_KEY = "..."'
    message: Hardcoded encryption key in class constant (CWE-321)
    languages: [php]
    severity: ERROR

  - id: php-const-secret-generic
    pattern: 'const $NAME = "..."'
    message: Constant with string value - verify not a secret (CWE-798)
    languages: [php]
    severity: INFO

  - id: php-const-private-secret
    pattern: 'private const $SECRET = "..."'
    message: Private constant with string value - verify not a secret (CWE-798)
    languages: [php]
    severity: WARNING

  - id: js-hardcoded-password-const
    pattern: 'const password = "..."'
    message: Hardcoded password constant (CWE-798)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-hardcoded-secret-const
    pattern: 'const secret = "..."'
    message: Hardcoded secret constant (CWE-798)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-hardcoded-apikey-const
    pattern: 'const apiKey = "..."'
    message: Hardcoded API key constant (CWE-798)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-hardcoded-api-key-const
    pattern: 'const api_key = "..."'
    message: Hardcoded API key constant (CWE-798)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-hardcoded-token-const
    pattern: 'const token = "..."'
    message: Hardcoded token constant (CWE-798)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-password-comparison-literal
    pattern: password === "..."
    message: Hardcoded password comparison (CWE-798)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-password-comparison-literal-2
    pattern: '"..." === password'
    message: Hardcoded password comparison (CWE-798)
    languages: [javascript, typescript]
    severity: ERROR

  - id: python-hardcoded-password
    pattern: PASSWORD = "..."
    message: Hardcoded password (CWE-798)
    languages: [python]
    severity: ERROR

  - id: python-hardcoded-secret
    pattern: SECRET = "..."
    message: Hardcoded secret (CWE-798)
    languages: [python]
    severity: ERROR

  - id: python-hardcoded-api-key
    pattern: API_KEY = "..."
    message: Hardcoded API key (CWE-798)
    languages: [python]
    severity: ERROR

  # =====================================================
  # Weak Token/Secret Detection
  # =====================================================

  - id: js-access-token-secret-hardcoded
    pattern: 'ACCESS_TOKEN_SECRET = "..."'
    message: Hardcoded access token secret - use environment variables (CWE-798)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-refresh-token-secret-hardcoded
    pattern: 'REFRESH_TOKEN_SECRET = "..."'
    message: Hardcoded refresh token secret - use environment variables (CWE-798)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-token-secret-hardcoded
    pattern: 'TOKEN_SECRET = "..."'
    message: Hardcoded token secret - use environment variables (CWE-798)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-jwt-secret-hardcoded
    pattern: 'JWT_SECRET = "..."'
    message: Hardcoded JWT secret - use environment variables (CWE-798)
    languages: [javascript, typescript]
    severity: ERROR

  - id: php-weak-encryption-key
    pattern: 'ENCRYPTION_KEY = "..."'
    message: Hardcoded encryption key - use secure key management (CWE-321)
    languages: [php]
    severity: ERROR

  - id: js-weak-encryption-key
    pattern: 'ENCRYPTION_KEY = "..."'
    message: Hardcoded encryption key - use secure key management (CWE-321)
    languages: [javascript, typescript]
    severity: ERROR

  - id: python-weak-secret-key
    pattern: 'SECRET_KEY = "..."'
    message: Hardcoded secret key - use environment variables (CWE-798)
    languages: [python]
    severity: ERROR

  # =====================================================
  # IDOR (Insecure Direct Object Reference) Detection
  # =====================================================

  - id: php-idor-direct-id-query
    pattern: '$RESULT = $DB->query("SELECT ... WHERE $FIELD = " . $_GET[$ID])'
    message: Potential IDOR - direct object reference without authorization check (CWE-639)
    languages: [php]
    severity: ERROR

  - id: php-idor-user-id-param
    pattern: '$USER_ID = $_GET["id"]'
    message: Potential IDOR - user ID from request parameter needs authorization check (CWE-639)
    languages: [php]
    severity: WARNING

  - id: php-idor-user-id-param-2
    pattern: '$USER_ID = $_GET["user_id"]'
    message: Potential IDOR - user ID from request parameter needs authorization check (CWE-639)
    languages: [php]
    severity: WARNING

  - id: js-idor-params-id
    pattern: 'req.params.id'
    message: Direct object reference from URL params - verify authorization check exists (CWE-639)
    languages: [javascript, typescript]
    severity: INFO

  - id: js-idor-query-userid
    pattern: 'req.query.userId'
    message: User ID from query params - verify authorization check exists (CWE-639)
    languages: [javascript, typescript]
    severity: WARNING

  - id: python-idor-request-args
    pattern: 'request.args.get("id")'
    message: Direct object reference from request args - verify authorization (CWE-639)
    languages: [python]
    severity: WARNING

  # =====================================================
  # Mass Assignment Detection
  # =====================================================

  - id: js-mass-assignment-body
    pattern: 'Object.assign($OBJ, req.body)'
    message: Mass assignment vulnerability - user input directly assigned to object (CWE-915)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-mass-assignment-spread
    pattern: '{ ...$OBJ, ...req.body }'
    message: Mass assignment via spread operator - validate allowed fields (CWE-915)
    languages: [javascript, typescript]
    severity: WARNING

  - id: js-mass-assignment-update
    pattern: '$MODEL.update(req.body)'
    message: Mass assignment in update - whitelist allowed fields (CWE-915)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-mass-assignment-create
    pattern: '$MODEL.create(req.body)'
    message: Mass assignment in create - whitelist allowed fields (CWE-915)
    languages: [javascript, typescript]
    severity: WARNING

  - id: python-mass-assignment-dict
    pattern: '$OBJ.__dict__.update(request.json)'
    message: Mass assignment via __dict__.update - whitelist fields (CWE-915)
    languages: [python]
    severity: ERROR

  - id: ruby-mass-assignment-params
    pattern: '$MODEL.new(params[$X])'
    message: Mass assignment - use strong parameters (CWE-915)
    languages: [ruby]
    severity: WARNING

  - id: ruby-mass-assignment-update
    pattern: '$MODEL.update(params[$X])'
    message: Mass assignment in update - use strong parameters (CWE-915)
    languages: [ruby]
    severity: WARNING

  - id: php-mass-assignment-post
    pattern: '$OBJ = $_POST'
    message: Mass assignment from POST data - validate and whitelist fields (CWE-915)
    languages: [php]
    severity: ERROR

  # DVWA-specific: API mass assignment patterns
  - id: php-raw-input-json
    pattern: 'json_decode(file_get_contents("php://input"), ...)'
    message: Raw JSON input from request body - validate and whitelist fields (CWE-915)
    languages: [php]
    severity: WARNING

  - id: php-input-to-array
    pattern: '$INPUT = (array) json_decode(file_get_contents(...), TRUE)'
    message: User input decoded to array - validate fields before use (CWE-915)
    languages: [php]
    severity: WARNING

  - id: php-direct-property-from-input
    pattern: '$OBJ->$PROP = $INPUT[$KEY]'
    message: Direct property assignment from user input - potential mass assignment (CWE-915)
    languages: [php]
    severity: WARNING

  - id: php-level-from-input
    pattern: '$DATA->level = $INPUT[$X]'
    message: User level/privilege set from input - privilege escalation risk (CWE-269)
    languages: [php]
    severity: ERROR

  - id: php-role-from-input
    pattern: '$DATA->role = $INPUT[$X]'
    message: User role set from input - privilege escalation risk (CWE-269)
    languages: [php]
    severity: ERROR

  - id: php-admin-from-input
    pattern: '$DATA->admin = $INPUT[$X]'
    message: Admin flag set from input - privilege escalation risk (CWE-269)
    languages: [php]
    severity: ERROR

  - id: php-is-admin-from-input
    pattern: '$DATA->is_admin = $INPUT[$X]'
    message: Admin flag set from input - privilege escalation risk (CWE-269)
    languages: [php]
    severity: ERROR

  # Array key assignment from input
  - id: php-array-level-from-input
    pattern: '$DATA[$ID]->level = intval ($INPUT[$X])'
    message: User level set from input array - privilege escalation (CWE-269)
    languages: [php]
    severity: ERROR

  - id: php-array-level-from-input-2
    pattern: '$DATA[$ID]->level = $INPUT[$X]'
    message: User level set from input - privilege escalation (CWE-269)
    languages: [php]
    severity: ERROR

  # =====================================================
  # HTTP Response Splitting / Header Injection
  # =====================================================

  - id: php-header-crlf-injection
    pattern: 'header("Location: " . $_GET[$X])'
    message: HTTP Response Splitting - user input in header without CRLF sanitization (CWE-113)
    languages: [php]
    severity: ERROR

  - id: php-header-crlf-injection-2
    pattern: 'header($_GET[$X])'
    message: HTTP Response Splitting - raw user input as header (CWE-113)
    languages: [php]
    severity: ERROR

  - id: php-header-crlf-injection-3
    pattern: 'header("$HEADER: " . $_GET[$X])'
    message: HTTP Response Splitting - user input in header value (CWE-113)
    languages: [php]
    severity: ERROR

  - id: php-header-post-injection
    pattern: 'header("Location: " . $_POST[$X])'
    message: HTTP Response Splitting - POST input in header (CWE-113)
    languages: [php]
    severity: ERROR

  # DVWA-specific: Exact pattern from open_redirect/source/low.php
  - id: php-open-redirect-location
    pattern: 'header ("location: " . $_GET[$X])'
    message: Open redirect - user controls Location header (CWE-601)
    languages: [php]
    severity: ERROR

  - id: php-open-redirect-location-2
    pattern: 'header("location: " . $_GET[$X])'
    message: Open redirect - user controls Location header (CWE-601)
    languages: [php]
    severity: ERROR

  - id: php-open-redirect-location-3
    pattern: 'header ("Location: " . $_GET[$X])'
    message: Open redirect - user controls Location header (CWE-601)
    languages: [php]
    severity: ERROR

  - id: js-setHeader-user-input
    pattern: 'res.setHeader($NAME, req.query.$X)'
    message: HTTP Response Splitting - user input in response header (CWE-113)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-setHeader-user-input-2
    pattern: 'res.setHeader($NAME, req.body.$X)'
    message: HTTP Response Splitting - user input in response header (CWE-113)
    languages: [javascript, typescript]
    severity: ERROR

  - id: python-header-injection
    pattern: 'response.headers[$NAME] = request.args.get($X)'
    message: HTTP Response Splitting - user input in response header (CWE-113)
    languages: [python]
    severity: ERROR

  # =====================================================
  # Information Disclosure
  # =====================================================

  - id: php-die-error-message
    pattern: 'die($ERROR)'
    message: Information disclosure - error details exposed to user (CWE-209)
    languages: [php]
    severity: WARNING

  - id: php-die-mysqli-error
    pattern: 'die(mysqli_error($CONN))'
    message: Information disclosure - database error exposed to user (CWE-209)
    languages: [php]
    severity: ERROR

  - id: php-echo-exception
    pattern: 'echo $EXCEPTION->getMessage()'
    message: Information disclosure - exception message exposed (CWE-209)
    languages: [php]
    severity: WARNING

  - id: php-echo-mysql-error
    pattern: 'echo mysql_error()'
    message: Information disclosure - MySQL error exposed to user (CWE-209)
    languages: [php]
    severity: ERROR

  - id: php-echo-pdo-error
    pattern: 'echo $PDO->errorInfo()'
    message: Information disclosure - PDO error exposed to user (CWE-209)
    languages: [php]
    severity: ERROR

  - id: js-error-message-response
    pattern: 'res.send($ERR.message)'
    message: Information disclosure - error message in response (CWE-209)
    languages: [javascript, typescript]
    severity: WARNING

  - id: js-error-stack-response
    pattern: 'res.send($ERR.stack)'
    message: Information disclosure - stack trace in response (CWE-209)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-console-error-sensitive
    pattern: 'console.log($PASSWORD)'
    message: Sensitive data logged - may expose credentials (CWE-532)
    languages: [javascript, typescript]
    severity: WARNING

  - id: python-traceback-print
    pattern: 'traceback.print_exc()'
    message: Information disclosure - traceback printed (CWE-209)
    languages: [python]
    severity: WARNING

  - id: python-exception-response
    pattern: 'return str($EXCEPTION)'
    message: Information disclosure - exception details in response (CWE-209)
    languages: [python]
    severity: WARNING

  # =====================================================
  # Predictable Session/Token IDs
  # =====================================================

  - id: php-predictable-session-id
    pattern: '$_SESSION[$X] = $_SESSION[$X] + 1'
    message: Predictable session value - sequential IDs are guessable (CWE-330)
    languages: [php]
    severity: ERROR

  - id: php-predictable-session-increment
    pattern: '$_SESSION[$X]++'
    message: Predictable session value - sequential increment (CWE-330)
    languages: [php]
    severity: ERROR

  # DVWA-specific: Exact pattern from weak_id/source/low.php
  - id: php-predictable-session-last-id
    pattern: "$_SESSION['last_session_id']++"
    message: Predictable session ID - sequential increment pattern (CWE-330)
    languages: [php]
    severity: ERROR

  - id: php-session-to-cookie
    pattern: '$COOKIE = $_SESSION[$X]'
    message: Session value used as cookie - verify not predictable (CWE-330)
    languages: [php]
    severity: WARNING

  - id: php-setcookie-session-value
    pattern: 'setcookie($NAME, $_SESSION[$X])'
    message: Cookie set from session value - verify not predictable (CWE-330)
    languages: [php]
    severity: WARNING

  - id: php-session-id-time
    pattern: 'session_id(time())'
    message: Predictable session ID based on time (CWE-330)
    languages: [php]
    severity: ERROR

  - id: php-session-id-md5-time
    pattern: 'session_id(md5(time()))'
    message: Predictable session ID - time-based MD5 is guessable (CWE-330)
    languages: [php]
    severity: ERROR

  - id: php-weak-session-id
    pattern: 'session_id(md5($USERNAME))'
    message: Weak session ID - predictable from username (CWE-330)
    languages: [php]
    severity: ERROR

  - id: js-predictable-token-date
    pattern: 'Date.now().toString()'
    message: Predictable token based on timestamp (CWE-330)
    languages: [javascript, typescript]
    severity: WARNING

  - id: js-uuid-v1-predictable
    pattern: 'uuid.v1()'
    message: UUID v1 is time-based and partially predictable - use v4 (CWE-330)
    languages: [javascript, typescript]
    severity: WARNING

  # =====================================================
  # Missing Security Headers
  # =====================================================

  - id: php-xss-protection-disabled
    pattern: 'header("X-XSS-Protection: 0")'
    message: XSS protection header disabled (CWE-693)
    languages: [php]
    severity: ERROR

  - id: php-content-type-options-missing
    pattern: 'header("X-Content-Type-Options: nosniff")'
    message: Good - X-Content-Type-Options header set
    languages: [php]
    severity: INFO

  - id: js-helmet-disabled
    pattern: 'app.use(helmet({ $OPTIONS }))'
    message: Review Helmet configuration - ensure security headers enabled
    languages: [javascript, typescript]
    severity: INFO

  - id: js-xss-protection-disabled
    pattern: 'res.setHeader("X-XSS-Protection", "0")'
    message: XSS protection header disabled (CWE-693)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-cors-wildcard
    pattern: 'cors({ origin: "*" })'
    message: CORS allows all origins - restrict to trusted domains (CWE-942)
    languages: [javascript, typescript]
    severity: WARNING

  - id: js-cors-credentials-wildcard
    pattern: 'cors({ origin: "*", credentials: true })'
    message: CORS with credentials and wildcard origin is dangerous (CWE-942)
    languages: [javascript, typescript]
    severity: ERROR

  # =====================================================
  # API Security Issues
  # =====================================================

  - id: js-api-no-auth-check
    pattern: 'app.get("/api/$PATH", ($REQ, $RES) => { ... })'
    message: API endpoint - verify authentication middleware exists
    languages: [javascript, typescript]
    severity: INFO

  - id: js-graphql-introspection
    pattern: 'introspection: true'
    message: GraphQL introspection enabled - disable in production (CWE-200)
    languages: [javascript, typescript]
    severity: WARNING

  - id: js-rate-limit-missing
    pattern: 'app.use("/api", $ROUTER)'
    message: API router - verify rate limiting is applied
    languages: [javascript, typescript]
    severity: INFO

  - id: python-flask-debug
    pattern: 'app.run(debug=True)'
    message: Flask debug mode enabled - disable in production (CWE-489)
    languages: [python]
    severity: ERROR

  - id: python-django-debug
    pattern: 'DEBUG = True'
    message: Django debug mode enabled - disable in production (CWE-489)
    languages: [python]
    severity: ERROR

  - id: js-express-error-handler
    pattern: 'app.use(($ERR, $REQ, $RES, $NEXT) => { $RES.send($ERR) })'
    message: Error handler exposes error details - sanitize before sending (CWE-209)
    languages: [javascript, typescript]
    severity: WARNING

  # =====================================================
  # Privilege Escalation Indicators
  # =====================================================

  - id: php-role-from-input
    pattern: '$ROLE = $_GET[$X]'
    message: User role from input - verify authorization (CWE-269)
    languages: [php]
    severity: ERROR

  - id: php-role-from-post
    pattern: '$ROLE = $_POST[$X]'
    message: User role from POST - verify authorization (CWE-269)
    languages: [php]
    severity: ERROR

  - id: php-admin-check-bypass
    pattern: 'if ($_GET[$X] == "admin")'
    message: Admin check via GET parameter - insecure authorization (CWE-639)
    languages: [php]
    severity: ERROR

  - id: js-role-from-body
    pattern: '$USER.role = req.body.role'
    message: User role from request body - mass assignment privilege escalation (CWE-269)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-isAdmin-from-body
    pattern: '$USER.isAdmin = req.body.isAdmin'
    message: Admin flag from request - privilege escalation vulnerability (CWE-269)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-level-from-body
    pattern: '$USER.level = req.body.level'
    message: User level from request body - privilege escalation risk (CWE-269)
    languages: [javascript, typescript]
    severity: ERROR

  # =====================================================
  # Unsafe Redirects
  # =====================================================

  - id: php-unsafe-redirect-header
    pattern: 'header("Location: " . $URL)'
    message: Redirect with variable URL - validate against whitelist (CWE-601)
    languages: [php]
    severity: WARNING

  - id: php-unsafe-redirect-get
    pattern: 'header("Location: " . $_REQUEST[$X])'
    message: Open redirect - user controls redirect destination (CWE-601)
    languages: [php]
    severity: ERROR

  - id: js-unsafe-redirect-query
    pattern: 'res.redirect(req.query.url)'
    message: Open redirect via query parameter (CWE-601)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-unsafe-redirect-body
    pattern: 'res.redirect(req.body.url)'
    message: Open redirect via body parameter (CWE-601)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-unsafe-redirect-next
    pattern: 'res.redirect(req.query.next)'
    message: Open redirect via next parameter (CWE-601)
    languages: [javascript, typescript]
    severity: ERROR

  - id: python-unsafe-redirect
    pattern: 'redirect(request.args.get($URL))'
    message: Open redirect via request argument (CWE-601)
    languages: [python]
    severity: ERROR

  # =====================================================
  # Path Traversal Extended
  # =====================================================

  - id: php-path-traversal-realpath
    pattern: 'realpath($_GET[$X])'
    message: Path traversal - realpath with user input (CWE-22)
    languages: [php]
    severity: ERROR

  - id: php-path-traversal-basename
    pattern: 'basename($_GET[$X])'
    message: Potential path manipulation - verify proper sanitization (CWE-22)
    languages: [php]
    severity: WARNING

  - id: php-path-traversal-dirname
    pattern: 'dirname($_GET[$X])'
    message: Path traversal attempt detection - user controls path (CWE-22)
    languages: [php]
    severity: ERROR

  - id: php-path-traversal-glob
    pattern: 'glob($_GET[$X])'
    message: Path traversal via glob - user controls pattern (CWE-22)
    languages: [php]
    severity: ERROR

  - id: js-path-traversal-join
    pattern: 'path.join($BASE, req.query.$X)'
    message: Path traversal - validate user input doesn't contain ../ (CWE-22)
    languages: [javascript, typescript]
    severity: WARNING

  - id: js-path-traversal-resolve
    pattern: 'path.resolve(req.query.$X)'
    message: Path traversal - user input in path.resolve (CWE-22)
    languages: [javascript, typescript]
    severity: ERROR

  # =====================================================
  # Insecure Randomness Extended
  # =====================================================

  - id: php-time-based-seed
    pattern: 'srand(time())'
    message: Predictable random seed based on time (CWE-330)
    languages: [php]
    severity: ERROR

  - id: php-mt-srand-time
    pattern: 'mt_srand(time())'
    message: Predictable Mersenne Twister seed (CWE-330)
    languages: [php]
    severity: ERROR

  - id: js-math-random-token
    pattern: 'Math.random().toString(36)'
    message: Math.random for token - use crypto.randomBytes (CWE-330)
    languages: [javascript, typescript]
    severity: ERROR

  - id: python-random-token
    pattern: 'random.choice($CHARS)'
    message: random module for security - use secrets module (CWE-330)
    languages: [python]
    severity: WARNING

  - id: python-random-randint-token
    pattern: 'random.randint($MIN, $MAX)'
    message: random.randint for security - use secrets.randbelow (CWE-330)
    languages: [python]
    severity: WARNING

  # =====================================================
  # JavaScript/TypeScript - SQL Injection (Juice Shop gaps)
  # =====================================================

  - id: js-sql-string-concat
    pattern: '$DB.query($Q + $INPUT)'
    message: SQL injection - string concatenation in query (CWE-89)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-sql-template-literal
    pattern: '$DB.query(`... ${$INPUT} ...`)'
    message: SQL injection - template literal with user input (CWE-89)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-sequelize-raw-query
    pattern: 'sequelize.query($Q + $INPUT)'
    message: Sequelize SQL injection - use parameterized queries (CWE-89)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-knex-raw-input
    pattern: 'knex.raw($Q + $INPUT)'
    message: Knex SQL injection - use parameterized queries (CWE-89)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-mysql-query-concat
    pattern: 'connection.query($Q + $INPUT)'
    message: MySQL SQL injection - use parameterized queries (CWE-89)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-pg-query-concat
    pattern: 'client.query($Q + $INPUT)'
    message: PostgreSQL SQL injection - use parameterized queries (CWE-89)
    languages: [javascript, typescript]
    severity: ERROR

  # =====================================================
  # JavaScript/TypeScript - NoSQL Injection (MongoDB)
  # =====================================================

  - id: js-mongodb-find-injection
    pattern: '$COLLECTION.find({ $FIELD: req.body.$INPUT })'
    message: NoSQL injection - unsanitized input in MongoDB query (CWE-943)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-mongodb-findone-injection
    pattern: '$COLLECTION.findOne({ $FIELD: req.body.$INPUT })'
    message: NoSQL injection - unsanitized input in MongoDB findOne (CWE-943)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-mongodb-where-injection
    pattern: '$COLLECTION.find({ $where: $INPUT })'
    message: NoSQL injection - $where with user input allows code execution (CWE-943)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-mongodb-regex-injection
    pattern: '$COLLECTION.find({ $FIELD: { $regex: req.$X.$Y } })'
    message: NoSQL ReDoS - user input in regex (CWE-1333)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-mongoose-find-body
    pattern: '$MODEL.find(req.body)'
    message: NoSQL injection - raw body passed to Mongoose find (CWE-943)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-mongoose-findone-body
    pattern: '$MODEL.findOne(req.body)'
    message: NoSQL injection - raw body passed to Mongoose findOne (CWE-943)
    languages: [javascript, typescript]
    severity: ERROR

  # =====================================================
  # JavaScript/TypeScript - XXE (XML External Entity)
  # =====================================================

  - id: js-xml2js-xxe
    pattern: 'xml2js.parseString($INPUT, ...)'
    message: XXE risk - xml2js may process external entities (CWE-611)
    languages: [javascript, typescript]
    severity: WARNING

  - id: js-libxmljs-parse
    pattern: 'libxmljs.parseXml($INPUT)'
    message: XXE risk - disable external entity processing (CWE-611)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-domparser-xml
    pattern: 'new DOMParser().parseFromString($INPUT, "text/xml")'
    message: XXE risk - parsing XML from user input (CWE-611)
    languages: [javascript, typescript]
    severity: WARNING

  - id: js-fast-xml-parser
    pattern: 'new XMLParser().parse($INPUT)'
    message: XXE risk - verify external entities are disabled (CWE-611)
    languages: [javascript, typescript]
    severity: WARNING

  # =====================================================
  # JavaScript/TypeScript - Insecure Deserialization
  # =====================================================

  - id: js-node-serialize
    pattern: 'serialize.unserialize($INPUT)'
    message: Insecure deserialization - node-serialize is vulnerable to RCE (CWE-502)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-funcster-deserialize
    pattern: 'funcster.deepDeserialize($INPUT)'
    message: Insecure deserialization - funcster allows code execution (CWE-502)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-js-yaml-load
    pattern: 'yaml.load($INPUT)'
    message: Insecure deserialization - yaml.load can execute code, use safeLoad (CWE-502)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-json-parse-reviver
    pattern: 'JSON.parse($INPUT, $REVIVER)'
    message: JSON.parse with reviver - verify reviver is safe (CWE-502)
    languages: [javascript, typescript]
    severity: INFO

  # =====================================================
  # JavaScript/TypeScript - Open Redirect Extended
  # =====================================================

  - id: js-redirect-header
    pattern: 'res.set("Location", req.$X.$Y)'
    message: Open redirect via Location header (CWE-601)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-redirect-writeHead
    pattern: 'res.writeHead($CODE, { Location: req.$X.$Y })'
    message: Open redirect via writeHead (CWE-601)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-window-location-assign
    pattern: 'window.location.assign($INPUT)'
    message: Open redirect - validate URL before redirect (CWE-601)
    languages: [javascript, typescript]
    severity: WARNING

  - id: js-window-location-href
    pattern: 'window.location.href = $INPUT'
    message: Open redirect - validate URL before redirect (CWE-601)
    languages: [javascript, typescript]
    severity: WARNING

  - id: js-window-location-replace
    pattern: 'window.location.replace($INPUT)'
    message: Open redirect - validate URL before redirect (CWE-601)
    languages: [javascript, typescript]
    severity: WARNING

  # =====================================================
  # JavaScript/TypeScript - Prototype Pollution
  # =====================================================

  - id: js-prototype-pollution-merge
    pattern: 'Object.assign({}, $INPUT)'
    message: Potential prototype pollution if input is untrusted (CWE-1321)
    languages: [javascript, typescript]
    severity: WARNING

  - id: js-prototype-pollution-lodash-merge
    pattern: '_.merge($TARGET, $INPUT)'
    message: Prototype pollution via lodash merge (CWE-1321)
    languages: [javascript, typescript]
    severity: WARNING

  - id: js-prototype-pollution-deepmerge
    pattern: 'deepmerge($TARGET, $INPUT)'
    message: Potential prototype pollution via deepmerge (CWE-1321)
    languages: [javascript, typescript]
    severity: WARNING

  - id: js-bracket-notation-input
    pattern: '$OBJ[req.$X.$Y] = $VALUE'
    message: Prototype pollution - bracket notation with user input (CWE-1321)
    languages: [javascript, typescript]
    severity: ERROR

  # =====================================================
  # JavaScript/TypeScript - Server-Side Request Forgery
  # =====================================================

  - id: js-ssrf-fetch
    pattern: 'fetch(req.$X.$Y)'
    message: SSRF - user input in fetch URL (CWE-918)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-ssrf-axios
    pattern: 'axios.get(req.$X.$Y)'
    message: SSRF - user input in axios URL (CWE-918)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-ssrf-axios-post
    pattern: 'axios.post(req.$X.$Y, ...)'
    message: SSRF - user input in axios URL (CWE-918)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-ssrf-request
    pattern: 'request(req.$X.$Y)'
    message: SSRF - user input in request URL (CWE-918)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-ssrf-got
    pattern: 'got(req.$X.$Y)'
    message: SSRF - user input in got URL (CWE-918)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-ssrf-http-get
    pattern: 'http.get(req.$X.$Y, ...)'
    message: SSRF - user input in http.get URL (CWE-918)
    languages: [javascript, typescript]
    severity: ERROR

  # =====================================================
  # JavaScript/TypeScript - Logging Sensitive Data
  # =====================================================

  - id: js-console-log-password
    pattern: 'console.log(..., password, ...)'
    message: Sensitive data logged - password in console.log (CWE-532)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-console-log-token
    pattern: 'console.log(..., token, ...)'
    message: Sensitive data logged - token in console.log (CWE-532)
    languages: [javascript, typescript]
    severity: WARNING

  - id: js-console-log-secret
    pattern: 'console.log(..., secret, ...)'
    message: Sensitive data logged - secret in console.log (CWE-532)
    languages: [javascript, typescript]
    severity: WARNING

  - id: js-console-log-apikey
    pattern: 'console.log(..., apiKey, ...)'
    message: Sensitive data logged - API key in console.log (CWE-532)
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-console-log-generic
    pattern: 'console.log(...)'
    message: Console.log statement found
    languages: [javascript, typescript]
    severity: INFO

  # =====================================================
  # JavaScript/TypeScript - Math.random() security
  # =====================================================

  - id: js-math-random-crypto
    pattern: 'Math.random()'
    message: Math.random() not cryptographically secure
    languages: [javascript, typescript]
    severity: INFO

  # =====================================================
  # JavaScript/TypeScript - Regex DoS (ReDoS)
  # =====================================================

  - id: js-regex-user-input
    pattern: 'new RegExp(req.$X.$Y)'
    message: Dynamic regex - potential ReDoS
    languages: [javascript, typescript]
    severity: ERROR

  - id: js-regex-from-variable
    pattern: 'new RegExp($PATTERN)'
    message: Dynamic regex - potential ReDoS
    languages: [javascript, typescript]
    severity: WARNING

  # =====================================================
  # JWT Security Vulnerabilities
  # =====================================================

  - id: jwt-verify-no-algorithm
    pattern: 'jwt.verify($TOKEN, $SECRET)'
    message: JWT verification without algorithm specification - vulnerable to algorithm confusion attacks (CWE-327)
    languages: [javascript, typescript]
    severity: ERROR

  - id: jwt-decode-without-verify
    pattern: 'jwt.decode($TOKEN)'
    message: JWT decoded without verification - tokens must be verified before trusting claims (CWE-345)
    languages: [javascript, typescript]
    severity: ERROR

  - id: jwt-algorithm-none
    pattern: 'algorithm: "none"'
    message: JWT using "none" algorithm - completely insecure, allows token forgery (CWE-327)
    languages: [javascript, typescript]
    severity: ERROR

  - id: jwt-weak-secret-hardcoded
    pattern: 'jwt.sign($PAYLOAD, "...")'
    message: JWT signed with hardcoded secret - use environment variables (CWE-798)
    languages: [javascript, typescript]
    severity: ERROR

  - id: jwt-hs256-public-key
    patterns:
      - pattern: |
          jwt.verify($TOKEN, $KEY, { algorithms: ["HS256"] })
    message: JWT using HS256 with potentially public key - vulnerable to key confusion attack (CWE-327)
    languages: [javascript, typescript]
    severity: WARNING

  - id: jwt-insecure-expiry
    pattern: 'expiresIn: "..d"'
    message: JWT with long expiration - consider shorter token lifetime for security
    languages: [javascript, typescript]
    severity: INFO

  - id: jsonwebtoken-sign-no-options
    pattern: 'jsonwebtoken.sign($PAYLOAD, $SECRET)'
    message: JWT sign without options - specify algorithm and expiration explicitly
    languages: [javascript, typescript]
    severity: WARNING

  # =====================================================
  # Prototype Pollution
  # =====================================================

  - id: prototype-pollution-merge
    pattern: 'merge($TARGET, $SOURCE)'
    message: Deep merge without prototype pollution protection - validate __proto__ and constructor (CWE-1321)
    languages: [javascript, typescript]
    severity: WARNING

  - id: prototype-pollution-extend
    pattern: 'extend($TARGET, $SOURCE)'
    message: Object extend without prototype pollution protection (CWE-1321)
    languages: [javascript, typescript]
    severity: WARNING

  - id: prototype-pollution-assign
    pattern: 'Object.assign($TARGET, JSON.parse($INPUT))'
    message: Object.assign with parsed user input - potential prototype pollution (CWE-1321)
    languages: [javascript, typescript]
    severity: ERROR

  - id: prototype-pollution-bracket-notation
    pattern: '$OBJ[$KEY] = $VALUE'
    message: Dynamic property assignment - ensure key is not __proto__ or constructor (CWE-1321)
    languages: [javascript, typescript]
    severity: INFO

  - id: prototype-pollution-lodash-set
    pattern: '_.set($OBJ, $PATH, $VALUE)'
    message: Lodash set with dynamic path - validate path does not contain __proto__ (CWE-1321)
    languages: [javascript, typescript]
    severity: WARNING

  - id: prototype-pollution-lodash-merge
    pattern: '_.merge($TARGET, $SOURCE)'
    message: Lodash merge can cause prototype pollution with untrusted data (CWE-1321)
    languages: [javascript, typescript]
    severity: WARNING

  - id: prototype-pollution-defaultsdeep
    pattern: '_.defaultsDeep($TARGET, $SOURCE)'
    message: Lodash defaultsDeep vulnerable to prototype pollution (CWE-1321)
    languages: [javascript, typescript]
    severity: ERROR

  - id: prototype-check-proto
    pattern: '$OBJ.__proto__'
    message: Direct __proto__ access detected - potential prototype pollution vector (CWE-1321)
    languages: [javascript, typescript]
    severity: WARNING

  - id: prototype-check-constructor
    pattern: '$OBJ.constructor.prototype'
    message: Constructor prototype access - potential prototype pollution (CWE-1321)
    languages: [javascript, typescript]
    severity: WARNING

  # =====================================================
  # Path Traversal / Directory Traversal
  # =====================================================

  - id: path-traversal-join-req
    pattern: 'path.join(..., req.$X.$Y, ...)'
    message: Path.join with user input - vulnerable to path traversal attacks (CWE-22)
    languages: [javascript, typescript]
    severity: ERROR

  - id: path-traversal-resolve-req
    pattern: 'path.resolve(..., req.$X.$Y, ...)'
    message: Path.resolve with user input - validate and sanitize paths (CWE-22)
    languages: [javascript, typescript]
    severity: ERROR

  - id: path-traversal-concat
    pattern: '$BASE + req.$X.$Y'
    message: String concatenation for file paths with user input - use path.join and validate (CWE-22)
    languages: [javascript, typescript]
    severity: ERROR

  - id: path-traversal-template
    pattern: '`${...}${req.$X.$Y}${...}`'
    message: Template literal with user input in path - vulnerable to traversal (CWE-22)
    languages: [javascript, typescript]
    severity: ERROR

  - id: path-traversal-sendfile
    pattern: 'res.sendFile(req.$X.$Y)'
    message: sendFile with user input - validate path does not contain .. sequences (CWE-22)
    languages: [javascript, typescript]
    severity: ERROR

  - id: path-traversal-download
    pattern: 'res.download(req.$X.$Y)'
    message: res.download with user input - vulnerable to arbitrary file download (CWE-22)
    languages: [javascript, typescript]
    severity: ERROR

  - id: path-traversal-static
    pattern: 'express.static(req.$X.$Y)'
    message: Static file serving with user-controlled path (CWE-22)
    languages: [javascript, typescript]
    severity: ERROR

  - id: path-traversal-createReadStream
    pattern: 'fs.createReadStream(req.$X.$Y)'
    message: createReadStream with user input - validate path before reading (CWE-22)
    languages: [javascript, typescript]
    severity: ERROR

  - id: path-traversal-createWriteStream
    pattern: 'fs.createWriteStream(req.$X.$Y)'
    message: createWriteStream with user input - arbitrary file write vulnerability (CWE-22)
    languages: [javascript, typescript]
    severity: ERROR

  - id: path-normalize-bypass
    pattern: 'path.normalize($USER_INPUT)'
    message: path.normalize alone does not prevent traversal - use realpath and validate (CWE-22)
    languages: [javascript, typescript]
    severity: WARNING

  # =====================================================
  # Server-Side Request Forgery (SSRF)
  # =====================================================

  - id: ssrf-fetch-user-url
    pattern: 'fetch(req.$X.$Y)'
    message: Fetch with user-controlled URL - SSRF vulnerability (CWE-918)
    languages: [javascript, typescript]
    severity: ERROR

  - id: ssrf-axios-user-url
    pattern: 'axios.get(req.$X.$Y)'
    message: Axios GET with user-controlled URL - SSRF vulnerability (CWE-918)
    languages: [javascript, typescript]
    severity: ERROR

  - id: ssrf-axios-post-user-url
    pattern: 'axios.post(req.$X.$Y, ...)'
    message: Axios POST with user-controlled URL - SSRF vulnerability (CWE-918)
    languages: [javascript, typescript]
    severity: ERROR

  - id: ssrf-axios-request-user-url
    pattern: 'axios({ url: req.$X.$Y, ... })'
    message: Axios request with user-controlled URL - SSRF vulnerability (CWE-918)
    languages: [javascript, typescript]
    severity: ERROR

  - id: ssrf-request-user-url
    pattern: 'request(req.$X.$Y)'
    message: Request module with user-controlled URL - SSRF vulnerability (CWE-918)
    languages: [javascript, typescript]
    severity: ERROR

  - id: ssrf-got-user-url
    pattern: 'got(req.$X.$Y)'
    message: Got with user-controlled URL - SSRF vulnerability (CWE-918)
    languages: [javascript, typescript]
    severity: ERROR

  - id: ssrf-http-get-user-url
    pattern: 'http.get(req.$X.$Y)'
    message: HTTP GET with user-controlled URL - SSRF vulnerability (CWE-918)
    languages: [javascript, typescript]
    severity: ERROR

  - id: ssrf-https-get-user-url
    pattern: 'https.get(req.$X.$Y)'
    message: HTTPS GET with user-controlled URL - SSRF vulnerability (CWE-918)
    languages: [javascript, typescript]
    severity: ERROR

  - id: ssrf-url-variable
    pattern: |
      $URL = req.$X.$Y
      ...
      fetch($URL)
    message: URL from user input passed to fetch - SSRF vulnerability (CWE-918)
    languages: [javascript, typescript]
    severity: ERROR

  - id: ssrf-image-proxy
    pattern: 'fetch($URL).then(...pipe(res)...)'
    message: Potential image/file proxy - ensure URL is validated against SSRF (CWE-918)
    languages: [javascript, typescript]
    severity: WARNING

  # =====================================================
  # Broken Access Control / IDOR
  # =====================================================

  - id: idor-direct-object-ref
    pattern: 'findById(req.params.id)'
    message: Direct object reference from URL params - verify user owns resource (CWE-639)
    languages: [javascript, typescript]
    severity: WARNING

  - id: idor-findone-params
    pattern: 'findOne({ _id: req.params.$X })'
    message: Database lookup with URL param - implement authorization check (CWE-639)
    languages: [javascript, typescript]
    severity: WARNING

  - id: idor-update-params
    pattern: 'updateOne({ _id: req.params.$X }, ...)'
    message: Database update with URL param - verify user has permission (CWE-639)
    languages: [javascript, typescript]
    severity: WARNING

  - id: idor-delete-params
    pattern: 'deleteOne({ _id: req.params.$X })'
    message: Database delete with URL param - implement ownership verification (CWE-639)
    languages: [javascript, typescript]
    severity: WARNING

  - id: idor-findbyid-body
    pattern: 'findById(req.body.$X)'
    message: Object lookup from request body - verify authorization (CWE-639)
    languages: [javascript, typescript]
    severity: WARNING

  - id: idor-where-userid
    pattern: 'where({ userId: req.params.$X })'
    message: User-controlled userId in query - users can access other users data (CWE-639)
    languages: [javascript, typescript]
    severity: ERROR

  - id: idor-prisma-findunique
    pattern: 'prisma.$MODEL.findUnique({ where: { id: req.params.$X } })'
    message: Prisma lookup with URL param - add authorization check (CWE-639)
    languages: [javascript, typescript]
    severity: WARNING

  - id: idor-sequelize-findone
    pattern: 'Model.findOne({ where: { id: req.params.$X } })'
    message: Sequelize lookup with URL param - verify user authorization (CWE-639)
    languages: [javascript, typescript]
    severity: WARNING

  - id: broken-access-role-header
    pattern: 'req.headers.$ROLE'
    message: Role/permission from request headers - headers can be spoofed by users (CWE-639)
    languages: [javascript, typescript]
    severity: ERROR

  - id: broken-access-admin-cookie
    pattern: 'req.cookies.isAdmin'
    message: Admin check from cookie - cookies can be manipulated by users (CWE-639)
    languages: [javascript, typescript]
    severity: ERROR

  - id: broken-access-client-role
    pattern: 'req.body.role'
    message: Role from request body - users can escalate their own privileges (CWE-639)
    languages: [javascript, typescript]
    severity: ERROR

  - id: broken-access-user-provided-id
    pattern: 'req.body.userId'
    message: UserId from request body - users can impersonate other users (CWE-639)
    languages: [javascript, typescript]
    severity: ERROR

  - id: mass-assignment-vulnerability
    pattern: 'Model.create(req.body)'
    message: Mass assignment - create/update directly from request body allows field injection (CWE-915)
    languages: [javascript, typescript]
    severity: ERROR

  - id: mass-assignment-update
    pattern: 'Model.update(req.body)'
    message: Mass assignment in update - whitelist allowed fields (CWE-915)
    languages: [javascript, typescript]
    severity: ERROR

  - id: mass-assignment-spread
    pattern: 'new Model({ ...req.body })'
    message: Spreading request body to model - potential mass assignment (CWE-915)
    languages: [javascript, typescript]
    severity: WARNING
